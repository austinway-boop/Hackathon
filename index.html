<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grow A Beanstock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #87CEEB;
        }

        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        .start-screen h1 {
            font-size: 4rem;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .start-button {
            padding: 20px 40px;
            font-size: 2rem;
            background: #FFA726;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            background: #FF9800;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: none;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('Assets/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .clouds-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .cloud {
            position: absolute;
            pointer-events: none;
        }

        .grass-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            background-image: url('Assets/grass.png');
            background-repeat: repeat-x;
            background-position: bottom;
            background-size: auto 250px;
            z-index: 6;
            pointer-events: none;
        }

        .pots-container {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 15px;
            z-index: 5;
            width: 95%;
            max-width: 1400px;
            height: 120px;
        }

        .pot {
            background-image: url('Assets/pot.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            width: 100px;
            height: 100px;
            cursor: default; /* No longer clickable - just show growth progress on hover */
            transition: all 0.3s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            position: relative;
            z-index: 10; /* Definitively in front of vines (z-index: 1) */
        }

        .pot:hover {
            transform: scale(1.15) translateY(-5px);
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
        }

        .pot.drag-hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px rgba(76, 175, 80, 0.6));
            transition: all 0.2s ease;
        }

        /* Vine Growing System */
        .vine {
            position: absolute;
            bottom: 40px; /* Start at pot level */
            left: 50%;
            transform: translateX(-50%) scale(0.3, 0); /* Start narrow and no height */
            transform-origin: bottom center; /* Grow upward from bottom */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom center;
            width: 250px; /* Much bigger width */
            height: 500px; /* Much bigger height */
            pointer-events: none; /* Default no pointer events during growth */
            z-index: 1; /* Definitely behind pot images */
            transition: transform 0.3s ease;
            visibility: visible; /* Ensure vine stays visible */
            opacity: 1; /* Ensure vine stays opaque */
        }

        .vine.growing {
            animation: vineGrowth linear forwards;
        }

        .vine.ready {
            transform: translateX(-50%) scale(1, 1) !important;
            animation: none; /* Remove golden glow animation */
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto; /* Enable hover for ready vines */
        }

        .vine.grown {
            transform: translateX(-50%) scale(1, 1) !important;
            animation: none; /* Stop any animations */
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto; /* Enable hover for grown vines */
        }

        /* Vine Hover Effect - like pot hover */
        .vine.ready:hover, .vine.grown:hover {
            transform: translateX(-50%) scale(1.1, 1.05) translateY(-3px) !important;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes vineGrowth {
            0% {
                transform: translateX(-50%) scale(0.3, 0); /* Start narrow and no height */
            }
            50% {
                transform: translateX(-50%) scale(0.7, 0.5); /* Mid growth - getting wider and taller */
            }
            100% {
                transform: translateX(-50%) scale(1, 1); /* Full size both ways */
            }
        }

        @keyframes readyPulse {
            from {
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.6));
            }
            to {
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.9));
            }
        }



        .pot.growing {
            filter: drop-shadow(0 0 8px rgba(76, 175, 80, 0.6));
        }

        @keyframes readyGlow {
            from {
                filter: drop-shadow(0 0 15px gold) drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            }
            to {
                filter: drop-shadow(0 0 25px orange) drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            }
        }

        @keyframes cloudMoveRight {
            0% {
                transform: translateX(-200px) scale(var(--start-scale)) translateY(0px);
            }
            25% {
                transform: translateX(25vw) scale(var(--mid-scale)) translateY(var(--drift-1));
            }
            50% {
                transform: translateX(50vw) scale(var(--end-scale)) translateY(var(--drift-2));
            }
            75% {
                transform: translateX(75vw) scale(var(--mid-scale)) translateY(var(--drift-1));
            }
            100% {
                transform: translateX(calc(100vw + 200px)) scale(var(--start-scale)) translateY(0px);
            }
        }

        @keyframes cloudMoveLeft {
            0% {
                transform: translateX(calc(100vw + 200px)) scale(var(--start-scale)) translateY(0px);
            }
            25% {
                transform: translateX(75vw) scale(var(--mid-scale)) translateY(var(--drift-1));
            }
            50% {
                transform: translateX(50vw) scale(var(--end-scale)) translateY(var(--drift-2));
            }
            75% {
                transform: translateX(25vw) scale(var(--mid-scale)) translateY(var(--drift-1));
            }
            100% {
                transform: translateX(-200px) scale(var(--start-scale)) translateY(0px);
            }
        }

        .cloud.moving-right {
            animation: cloudMoveRight linear infinite;
        }

        .cloud.moving-left {
            animation: cloudMoveLeft linear infinite;
        }

        .hidden {
            display: none !important;
        }

        /* UI Container Styles */
        .ui-container {
            position: absolute;
            top: 30px;
            right: 40px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: flex-end;
        }

        .money-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 4px solid #8B4513;
            border-radius: 15px;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.4),
                inset 0 -2px 4px rgba(0,0,0,0.2);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 24px;
            color: #4A4A4A;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            animation: moneyGlow 3s ease-in-out infinite alternate;
            min-width: 150px;
            pointer-events: none;
        }

        .shop-button {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border: 4px solid #1B5E20;
            border-radius: 15px;
            padding: 12px 24px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 20px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.2),
                inset 0 -2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: 120px;
            animation: shopGlow 4s ease-in-out infinite alternate;
        }

        .shop-button:hover {
            background: linear-gradient(135deg, #66BB6A, #388E3C);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(0,0,0,0.4),
                inset 0 2px 4px rgba(255,255,255,0.3),
                inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .shop-button:active {
            transform: translateY(0px);
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .inventory-button {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border: 4px solid #0D47A1;
            border-radius: 15px;
            padding: 12px 24px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 20px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.2),
                inset 0 -2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: 120px;
            animation: inventoryGlow 5s ease-in-out infinite alternate;
        }

        .inventory-button:hover {
            background: linear-gradient(135deg, #42A5F5, #1E88E5);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(0,0,0,0.4),
                inset 0 2px 4px rgba(255,255,255,0.3),
                inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .inventory-button:active {
            transform: translateY(0px);
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .money-amount {
            letter-spacing: 1px;
            text-align: center;
            transition: all 0.3s ease;
        }

        @keyframes moneyGlow {
            0% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.4),
                    inset 0 -2px 4px rgba(0,0,0,0.2),
                    0 0 15px rgba(255, 215, 0, 0.6);
            }
            100% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.4),
                    inset 0 -2px 4px rgba(0,0,0,0.2),
                    0 0 25px rgba(255, 215, 0, 0.9);
            }
        }

        @keyframes shopGlow {
            0% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.2),
                    inset 0 -2px 4px rgba(0,0,0,0.3),
                    0 0 10px rgba(76, 175, 80, 0.4);
            }
            100% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.2),
                    inset 0 -2px 4px rgba(0,0,0,0.3),
                    0 0 20px rgba(76, 175, 80, 0.7);
            }
        }

        @keyframes inventoryGlow {
            0% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.2),
                    inset 0 -2px 4px rgba(0,0,0,0.3),
                    0 0 10px rgba(33, 150, 243, 0.4);
            }
            100% {
                box-shadow: 
                    0 4px 8px rgba(0,0,0,0.3),
                    inset 0 2px 4px rgba(255,255,255,0.2),
                    inset 0 -2px 4px rgba(0,0,0,0.3),
                    0 0 20px rgba(33, 150, 243, 0.7);
            }
        }

        /* Money change animation */
        .money-amount.changing {
            animation: moneyChange 0.5s ease-in-out;
        }

        @keyframes moneyChange {
            0% { 
                transform: scale(1);
                color: #4A4A4A;
            }
            50% { 
                transform: scale(1.2);
                color: #FF6B35;
                text-shadow: 0 0 8px rgba(255, 107, 53, 0.8);
            }
            100% { 
                transform: scale(1);
                color: #4A4A4A;
            }
        }

        /* Bean spawn system styles */
        .vine-bean {
            position: absolute !important;
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 3;
            pointer-events: auto !important; /* Enable hover interactions */
            transform-origin: center;
            transition: all 0.3s ease; /* Smooth hover transition */
            cursor: pointer; /* Show it's interactive */
            /* NO DEFAULT ANIMATION - will be added after spawning */
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }

        /* Hover effect for beans - expand slightly while preserving rotation (but not when clicked or flying) */
        .vine-bean:hover:not(.clicked):not(.flying-to-money) {
            transform: scale(calc(var(--final-scale) * 1.3)) rotate(var(--final-rotation)) !important;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.9)) !important;
            z-index: 4; /* Bring hovered bean to front */
        }

        /* Satisfying click effect for beans */
        .vine-bean.clicked {
            animation: beanClickPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards !important;
        }

        @keyframes beanClickPop {
            0% {
                transform: scale(var(--final-scale)) rotate(var(--final-rotation));
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
            }
            50% {
                transform: scale(calc(var(--final-scale) * 1.8)) rotate(calc(var(--final-rotation) + 15deg));
                filter: drop-shadow(0 0 25px rgba(255, 215, 0, 1.2)) drop-shadow(0 0 50px rgba(255, 215, 0, 0.8));
            }
            100% {
                transform: scale(calc(var(--final-scale) * 1.3)) rotate(calc(var(--final-rotation) + 10deg));
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1.0)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.6));
            }
        }

        /* Click burst effect around bean */
        .click-burst {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 99;
            animation: clickBurstAnimation 0.4s ease-out forwards;
        }

        @keyframes clickBurstAnimation {
            0% {
                transform: scale(0);
                opacity: 1;
                background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, rgba(255,215,0,0.4) 30%, rgba(255,255,255,0.2) 60%, transparent 100%);
                box-shadow: 0 0 20px rgba(255,215,0,0.8);
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
                background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0.3) 30%, rgba(255,255,255,0.1) 60%, transparent 100%);
                box-shadow: 0 0 40px rgba(255,215,0,0.6);
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
                background: radial-gradient(circle, transparent 0%, transparent 30%, transparent 60%, transparent 100%);
                box-shadow: 0 0 60px rgba(255,215,0,0.2);
            }
        }

        /* Amazing bean-to-money flying animation */
        .vine-bean.flying-to-money {
            z-index: 100 !important; /* Above everything */
            pointer-events: none !important; /* No more interactions */
            animation: none !important; /* Stop pulsing */
            transition: none !important; /* Disable normal transitions */
            /* Make the flying bean more prominent */
            transform: scale(1.2) !important;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1.0)) drop-shadow(0 0 30px rgba(255, 215, 0, 0.7)) !important;
        }

        @keyframes beanFlyToMoney {
            0% {
                transform: scale(1.2) rotate(0deg);
                opacity: 1;
                filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1.0)) drop-shadow(0 0 30px rgba(255, 215, 0, 0.7));
            }
            25% {
                transform: scale(1.5) rotate(180deg);
                opacity: 1;
                filter: drop-shadow(0 0 25px rgba(255, 215, 0, 1.2)) drop-shadow(0 0 50px rgba(255, 215, 0, 0.8)) drop-shadow(0 0 75px rgba(255, 255, 255, 0.4));
            }
            50% {
                transform: scale(1.3) rotate(360deg);
                opacity: 1;
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1.4)) drop-shadow(0 0 60px rgba(255, 215, 0, 0.9)) drop-shadow(0 0 90px rgba(255, 255, 255, 0.5));
            }
            75% {
                transform: scale(1.1) rotate(540deg);
                opacity: 0.9;
                filter: drop-shadow(0 0 35px rgba(255, 215, 0, 1.5)) drop-shadow(0 0 70px rgba(255, 215, 0, 1.0)) drop-shadow(0 0 105px rgba(255, 255, 255, 0.6));
            }
            100% {
                transform: scale(0.8) rotate(720deg);
                opacity: 0.7;
                filter: drop-shadow(0 0 40px rgba(255, 215, 0, 1.6)) drop-shadow(0 0 80px rgba(255, 215, 0, 1.1)) drop-shadow(0 0 120px rgba(255, 255, 255, 0.7));
            }
        }

        /* Trail effect for flying beans */
        .vine-bean.flying-to-money::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            left: -10px;
            top: -10px;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, rgba(255,215,0,0.1) 50%, transparent 100%);
            border-radius: 50%;
            animation: trailPulse 0.3s ease-out infinite;
        }

        @keyframes trailPulse {
            0% {
                transform: scale(0.8);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.3;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Subtle screen shake for satisfying feedback */
        @keyframes screenShake {
            0% { transform: translateX(0); }
            10% { transform: translateX(-2px) translateY(1px); }
            20% { transform: translateX(2px) translateY(-1px); }
            30% { transform: translateX(-1px) translateY(2px); }
            40% { transform: translateX(1px) translateY(-2px); }
            50% { transform: translateX(-2px) translateY(1px); }
            60% { transform: translateX(2px) translateY(-1px); }
            70% { transform: translateX(-1px) translateY(2px); }
            80% { transform: translateX(1px) translateY(-2px); }
            90% { transform: translateX(-1px) translateY(1px); }
            100% { transform: translateX(0); }
        }

        /* Money burst effect when beans are collected */
        .money-burst {
            position: fixed;
            color: #FFD700;
            font-weight: bold;
            font-size: 24px;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 101;
            pointer-events: none;
            animation: moneyBurst 1.5s ease-out forwards;
        }

        @keyframes moneyBurst {
            0% {
                transform: scale(0.5) translateY(0px);
                opacity: 0;
            }
            20% {
                transform: scale(1.2) translateY(-10px);
                opacity: 1;
            }
            100% {
                transform: scale(1.0) translateY(-40px);
                opacity: 0;
            }
        }

        /* Only apply pulsing animation after bean is spawned and positioned, but pause on hover and when clicked */
        .vine-bean.spawned:not(:hover):not(.clicked):not(.flying-to-money) {
            animation: beanPulse 2s ease-in-out infinite alternate;
        }

        @keyframes beanPulse {
            0% {
                /* Use CSS variables to preserve individual bean transforms */
                transform: scale(calc(var(--final-scale) * 0.9)) rotate(var(--final-rotation));
                opacity: 0.8;
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
            }
            50% {
                transform: scale(calc(var(--final-scale) * 1.1)) rotate(var(--final-rotation));
                opacity: 1;
                filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.8));
            }
            100% {
                transform: scale(calc(var(--final-scale) * 0.95)) rotate(var(--final-rotation));
                opacity: 0.9;
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7));
            }
        }

        /* Initial spawning state for beans */
        .vine-bean:not(.spawned) {
            transform-origin: center;
            /* Initial state - invisible and small */
            opacity: 0;
            transform: scale(0) rotate(0deg);
            transition: all 0.5s ease-out;
        }

        .vine-bean.spawned {
            /* Visible state after spawning */
            opacity: 0.8;
            transition: all 0.5s ease-out;
        }

        /* Special effects for shiny (silver) beans - 3% chance, 200% more valuable */
        .vine-bean.rarity-shiny {
            background: linear-gradient(45deg, 
                rgba(192, 192, 192, 0.3), 
                rgba(255, 255, 255, 0.6), 
                rgba(192, 192, 192, 0.3), 
                rgba(255, 255, 255, 0.6)) !important;
            background-blend-mode: overlay !important;
            box-shadow: 0 0 20px rgba(192, 192, 192, 0.7), 
                       inset 0 0 20px rgba(255, 255, 255, 0.3) !important;
            animation: silverShimmer 2s ease-in-out infinite alternate, beanPulse 2s ease-in-out infinite alternate !important;
        }

        .vine-bean.rarity-shiny:hover:not(.clicked):not(.flying-to-money) {
            transform: scale(calc(var(--final-scale) * 1.4)) rotate(var(--final-rotation)) !important;
            filter: drop-shadow(0 0 25px rgba(192, 192, 192, 1)) !important;
            box-shadow: 0 0 30px rgba(192, 192, 192, 1), 
                       inset 0 0 25px rgba(255, 255, 255, 0.5) !important;
        }

        @keyframes silverShimmer {
            0% {
                background-position: -200% 0;
                filter: brightness(1.2) contrast(1.1);
            }
            100% {
                background-position: 200% 0;
                filter: brightness(1.4) contrast(1.2);
            }
        }

        /* Special effects for golden beans - 3% chance, 500% more valuable */
        .vine-bean.rarity-golden {
            background: linear-gradient(45deg, 
                rgba(255, 215, 0, 0.4), 
                rgba(255, 255, 255, 0.8), 
                rgba(255, 215, 0, 0.4), 
                rgba(255, 255, 255, 0.8)) !important;
            background-blend-mode: overlay !important;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.9), 
                       inset 0 0 25px rgba(255, 255, 255, 0.4) !important;
            animation: goldenGlow 1.5s ease-in-out infinite alternate, beanPulse 2s ease-in-out infinite alternate !important;
        }

        .vine-bean.rarity-golden:hover:not(.clicked):not(.flying-to-money) {
            transform: scale(calc(var(--final-scale) * 1.5)) rotate(var(--final-rotation)) !important;
            filter: drop-shadow(0 0 35px rgba(255, 215, 0, 1)) !important;
            box-shadow: 0 0 40px rgba(255, 215, 0, 1), 
                       inset 0 0 30px rgba(255, 255, 255, 0.6) !important;
        }

        @keyframes goldenGlow {
            0% {
                background-position: -200% 0;
                filter: brightness(1.3) contrast(1.2) saturate(1.2);
            }
            100% {
                background-position: 200% 0;
                filter: brightness(1.6) contrast(1.4) saturate(1.4);
            }
        }

        /* Enhanced flying effects for special beans */
        .vine-bean.rarity-shiny.flying-to-money {
            box-shadow: 0 0 40px rgba(192, 192, 192, 1) !important;
            animation: silverTrail 0.1s linear infinite !important;
        }

        .vine-bean.rarity-golden.flying-to-money {
            box-shadow: 0 0 50px rgba(255, 215, 0, 1) !important;
            animation: goldenTrail 0.1s linear infinite !important;
        }

        @keyframes silverTrail {
            0% { filter: brightness(1.4) contrast(1.2); }
            50% { filter: brightness(1.6) contrast(1.3); }
            100% { filter: brightness(1.4) contrast(1.2); }
        }

        @keyframes goldenTrail {
            0% { filter: brightness(1.5) contrast(1.3) saturate(1.3); }
            50% { filter: brightness(1.8) contrast(1.5) saturate(1.5); }
            100% { filter: brightness(1.5) contrast(1.3) saturate(1.3); }
        }

        /* Growth Tooltip Styles */
        .growth-tooltip {
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border: 2px solid #3498DB;
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            font-family: 'Arial', sans-serif;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            animation: tooltipFadeIn 0.2s ease-out;
            max-width: 200px;
        }

        .growth-tooltip .tooltip-header {
            font-weight: bold;
            color: #3498DB;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .growth-tooltip .tooltip-progress {
            margin-bottom: 6px;
            color: #BDC3C7;
        }

        .growth-tooltip .tooltip-bar {
            width: 100%;
            height: 6px;
            background: rgba(52, 73, 94, 0.8);
            border-radius: 3px;
            overflow: hidden;
        }

        .growth-tooltip .tooltip-fill {
            height: 100%;
            background: linear-gradient(90deg, #27AE60, #2ECC71);
            border-radius: 3px;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.5);
        }

        @keyframes tooltipFadeIn {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(5px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }



        /* Inventory Panel Styles */
        .inventory-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 15;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .inventory-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .inventory-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border-left: 4px solid #3498DB;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
            z-index: 20;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .inventory-panel.active {
            right: 0;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #3498DB, #2980B9);
            border-bottom: 3px solid #1F618D;
            position: sticky;
            top: 0;
            z-index: 21;
        }

        .inventory-header h2 {
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 24px;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .inventory-close {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .inventory-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .inventory-content {
            padding: 20px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .inventory-item {
            background: linear-gradient(135deg, #4A5A6A, #34495E);
            border: 2px solid #52708A;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .inventory-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
            border-color: #3498DB;
        }



        .inventory-item-icon {
            width: 80px;
            height: 80px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin: 0 auto;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .inventory-item.rarity-common .inventory-item-icon {
            filter: drop-shadow(0 0 8px rgba(149, 165, 166, 0.7)) drop-shadow(0 0 16px rgba(149, 165, 166, 0.4));
        }

        .inventory-item.rarity-uncommon .inventory-item-icon {
            filter: drop-shadow(0 0 8px rgba(52, 152, 219, 0.7)) drop-shadow(0 0 16px rgba(52, 152, 219, 0.4));
        }

        .inventory-item.rarity-rare .inventory-item-icon {
            filter: drop-shadow(0 0 8px rgba(155, 89, 182, 0.7)) drop-shadow(0 0 16px rgba(155, 89, 182, 0.4));
        }

        .inventory-item.rarity-legendary .inventory-item-icon {
            filter: drop-shadow(0 0 8px rgba(243, 156, 18, 0.8)) drop-shadow(0 0 16px rgba(243, 156, 18, 0.5)) drop-shadow(0 0 24px rgba(243, 156, 18, 0.3));
        }

        .inventory-item:hover .inventory-item-icon {
            transform: scale(1.15);
        }

        .inventory-item:hover.rarity-common .inventory-item-icon {
            filter: drop-shadow(0 0 12px rgba(149, 165, 166, 0.9)) drop-shadow(0 0 24px rgba(149, 165, 166, 0.6));
        }

        .inventory-item:hover.rarity-uncommon .inventory-item-icon {
            filter: drop-shadow(0 0 12px rgba(52, 152, 219, 0.9)) drop-shadow(0 0 24px rgba(52, 152, 219, 0.6));
        }

        .inventory-item:hover.rarity-rare .inventory-item-icon {
            filter: drop-shadow(0 0 12px rgba(155, 89, 182, 0.9)) drop-shadow(0 0 24px rgba(155, 89, 182, 0.6));
        }

        .inventory-item:hover.rarity-legendary .inventory-item-icon {
            filter: drop-shadow(0 0 12px rgba(243, 156, 18, 1.0)) drop-shadow(0 0 24px rgba(243, 156, 18, 0.7)) drop-shadow(0 0 36px rgba(243, 156, 18, 0.4));
        }

        .inventory-item-quantity {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Empty inventory message */
        .inventory-empty {
            text-align: center;
            color: #BDC3C7;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-top: 40px;
            opacity: 0.7;
        }

        .inventory-empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* Seed Tooltip Styles */
        .seed-tooltip {
            position: fixed;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border: 3px solid #3498DB;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(52, 152, 219, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.1);
            z-index: 1500;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8) translateY(10px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            min-width: 280px;
            max-width: 320px;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .seed-tooltip.visible {
            opacity: 1;
            transform: scale(1) translateY(0px);
        }

        .tooltip-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
        }

        .tooltip-icon {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-right: 12px;
            border-radius: 8px;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }

        .tooltip-title {
            flex: 1;
        }

        .tooltip-name {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .tooltip-rarity {
            font-size: 12px;
            margin: 2px 0 0 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tooltip-rarity.common { color: #95A5A6; }
        .tooltip-rarity.uncommon { color: #3498DB; }
        .tooltip-rarity.rare { color: #9B59B6; }
        .tooltip-rarity.legendary { color: #F39C12; }
        .tooltip-rarity.mythical { color: #E74C3C; }
        .tooltip-rarity.ultra-mythical { color: #8E44AD; }
        .tooltip-rarity.godly { 
            background: linear-gradient(45deg, #F39C12, #E74C3C, #9B59B6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }

        .tooltip-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tooltip-stat {
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .stat-icon {
            width: 16px;
            height: 16px;
            margin-right: 6px;
            opacity: 0.7;
        }

        .tooltip-description {
            font-size: 12px;
            font-style: italic;
            color: #BDC3C7;
            text-align: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(52, 152, 219, 0.2);
        }

        /* Drag and Drop Styles */
        .dragging-seed {
            position: fixed;
            width: 80px;
            height: 80px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.9;
            transform: translate(-50%, -50%);
            transition: none;
        }

        .dragging-seed.rarity-common {
            filter: drop-shadow(0 0 10px rgba(149, 165, 166, 0.9)) drop-shadow(0 0 20px rgba(149, 165, 166, 0.6));
        }

        .dragging-seed.rarity-uncommon {
            filter: drop-shadow(0 0 10px rgba(52, 152, 219, 0.9)) drop-shadow(0 0 20px rgba(52, 152, 219, 0.6));
        }

        .dragging-seed.rarity-rare {
            filter: drop-shadow(0 0 10px rgba(155, 89, 182, 0.9)) drop-shadow(0 0 20px rgba(155, 89, 182, 0.6));
        }

        .dragging-seed.rarity-legendary {
            filter: drop-shadow(0 0 10px rgba(243, 156, 18, 1.0)) drop-shadow(0 0 20px rgba(243, 156, 18, 0.8)) drop-shadow(0 0 30px rgba(243, 156, 18, 0.5));
        }

        .inventory-item.dragging {
            opacity: 0.5;
            transform: scale(0.9);
        }

        .dragging-seed.pouring {
            transform: translate(-50%, -50%) rotate(45deg);
            transition: transform 0.2s ease;
        }

        /* Shop Panel Styles */
        .shop-panel {
            position: fixed;
            top: 0;
            left: -450px;
            width: 450px;
            height: 100vh;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border-right: 4px solid #4CAF50;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            z-index: 20;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .shop-panel.active {
            left: 0;
        }

        .shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 15;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .shop-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border-bottom: 3px solid #1B5E20;
            position: sticky;
            top: 0;
            z-index: 21;
        }

        .shop-header h2 {
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 24px;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .shop-timer {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .shop-timer span {
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        #timerDisplay {
            color: #FFE082 !important;
            text-shadow: 0 0 5px rgba(255, 224, 130, 0.5) !important;
        }

        .shop-close {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .shop-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .shop-content {
            padding: 20px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .shop-item {
            background: linear-gradient(135deg, #4A5A6A, #34495E);
            border: 2px solid #52708A;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }



        .shop-item-icon {
            width: 90px;
            height: 90px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin: 0 auto 10px auto;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .shop-item.rarity-common .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(149, 165, 166, 0.7)) drop-shadow(0 0 16px rgba(149, 165, 166, 0.4));
        }

        .shop-item.rarity-uncommon .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(52, 152, 219, 0.7)) drop-shadow(0 0 16px rgba(52, 152, 219, 0.4));
        }

        .shop-item.rarity-rare .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(155, 89, 182, 0.7)) drop-shadow(0 0 16px rgba(155, 89, 182, 0.4));
        }

        .shop-item.rarity-legendary .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(243, 156, 18, 0.8)) drop-shadow(0 0 16px rgba(243, 156, 18, 0.5)) drop-shadow(0 0 24px rgba(243, 156, 18, 0.3));
        }

        .shop-item.rarity-mythical .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(233, 30, 99, 0.8)) drop-shadow(0 0 16px rgba(233, 30, 99, 0.5)) drop-shadow(0 0 24px rgba(233, 30, 99, 0.3));
        }

        .shop-item.rarity-ultra_mythical .shop-item-icon {
            filter: drop-shadow(0 0 8px rgba(156, 39, 176, 0.9)) drop-shadow(0 0 16px rgba(156, 39, 176, 0.6)) drop-shadow(0 0 32px rgba(156, 39, 176, 0.4));
        }

        .shop-item.rarity-godly .shop-item-icon {
            filter: 
                drop-shadow(0 0 10px rgba(255, 215, 0, 1.0)) 
                drop-shadow(0 0 20px rgba(255, 69, 0, 0.8)) 
                drop-shadow(0 0 30px rgba(255, 20, 147, 0.6))
                drop-shadow(0 0 40px rgba(138, 43, 226, 0.4));
            animation: godlyPulse 2s ease-in-out infinite alternate;
        }

        @keyframes godlyPulse {
            0% { 
                filter: 
                    drop-shadow(0 0 10px rgba(255, 215, 0, 1.0)) 
                    drop-shadow(0 0 20px rgba(255, 69, 0, 0.8)) 
                    drop-shadow(0 0 30px rgba(255, 20, 147, 0.6))
                    drop-shadow(0 0 40px rgba(138, 43, 226, 0.4));
            }
            100% { 
                filter: 
                    drop-shadow(0 0 15px rgba(255, 215, 0, 1.0)) 
                    drop-shadow(0 0 25px rgba(255, 69, 0, 1.0)) 
                    drop-shadow(0 0 35px rgba(255, 20, 147, 0.8))
                    drop-shadow(0 0 50px rgba(138, 43, 226, 0.6));
            }
        }

        .shop-item.available:hover .shop-item-icon {
            transform: scale(1.15);
        }

        .shop-item.available:hover.rarity-common .shop-item-icon {
            filter: drop-shadow(0 0 12px rgba(149, 165, 166, 0.9)) drop-shadow(0 0 24px rgba(149, 165, 166, 0.6));
        }

        .shop-item.available:hover.rarity-uncommon .shop-item-icon {
            filter: drop-shadow(0 0 12px rgba(52, 152, 219, 0.9)) drop-shadow(0 0 24px rgba(52, 152, 219, 0.6));
        }

        .shop-item.available:hover.rarity-rare .shop-item-icon {
            filter: drop-shadow(0 0 12px rgba(155, 89, 182, 0.9)) drop-shadow(0 0 24px rgba(155, 89, 182, 0.6));
        }

        .shop-item.available:hover.rarity-legendary .shop-item-icon {
            filter: drop-shadow(0 0 12px rgba(243, 156, 18, 1.0)) drop-shadow(0 0 24px rgba(243, 156, 18, 0.7)) drop-shadow(0 0 36px rgba(243, 156, 18, 0.4));
        }

        .shop-item.available:hover.rarity-mythical .shop-item-icon {
            filter: drop-shadow(0 0 12px rgba(233, 30, 99, 1.0)) drop-shadow(0 0 24px rgba(233, 30, 99, 0.7)) drop-shadow(0 0 36px rgba(233, 30, 99, 0.4));
        }

        .shop-item.available:hover.rarity-ultra_mythical .shop-item-icon {
            filter: drop-shadow(0 0 15px rgba(156, 39, 176, 1.0)) drop-shadow(0 0 30px rgba(156, 39, 176, 0.8)) drop-shadow(0 0 45px rgba(156, 39, 176, 0.5));
        }

        .shop-item.available:hover.rarity-godly .shop-item-icon {
            filter: 
                drop-shadow(0 0 15px rgba(255, 215, 0, 1.0)) 
                drop-shadow(0 0 30px rgba(255, 69, 0, 1.0)) 
                drop-shadow(0 0 45px rgba(255, 20, 147, 0.8))
                drop-shadow(0 0 60px rgba(138, 43, 226, 0.6));
        }

        .shop-item.unavailable .shop-item-icon {
            filter: drop-shadow(0 0 6px rgba(127, 140, 141, 0.4));
            opacity: 0.5;
        }

        .shop-item-price {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #4A4A4A;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 20px;
            border: 2px solid #8B4513;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }

        .shop-item-stock {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            text-shadow: none;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .shop-item-stock.low-stock {
            background: linear-gradient(135deg, #FF6B6B, #E74C3C);
            color: white;
            animation: lowStockPulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes lowStockPulse {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .shop-item-status {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 3px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .shop-item-status.too-expensive {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: 1px solid #A93226;
            animation: expensivePulse 2s ease-in-out infinite alternate;
        }

        .shop-item-status.out-of-stock {
            background: linear-gradient(135deg, #95A5A6, #7F8C8D);
            color: #2C3E50;
            border: 1px solid #5D6D7E;
            animation: stockPulse 1.8s ease-in-out infinite alternate;
        }

        @keyframes expensivePulse {
            0% { opacity: 0.8; box-shadow: 0 0 5px rgba(231, 76, 60, 0.3); }
            100% { opacity: 1; box-shadow: 0 0 10px rgba(231, 76, 60, 0.6); }
        }

        @keyframes stockPulse {
            0% { opacity: 0.7; }
            100% { opacity: 0.9; }
        }



        .shop-item.unavailable {
            opacity: 0.6;
            background: linear-gradient(135deg, #7F8C8D, #95A5A6);
            border-color: #BDC3C7;
            cursor: not-allowed;
        }

        .shop-item.unavailable:hover {
            transform: none;
            box-shadow: none;
            border-color: #BDC3C7;
        }

        /* Purchase Modal Styles */
        .purchase-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .purchase-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .purchase-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            background: linear-gradient(145deg, #2C3E50, #34495E);
            border: 3px solid #4CAF50;
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(76, 175, 80, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            min-width: 400px;
            max-width: 500px;
        }

        .purchase-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .purchase-modal-content {
            padding: 0;
        }

        .purchase-header {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            padding: 20px;
            border-radius: 17px 17px 0 0;
            border-bottom: 2px solid #1B5E20;
        }

        .purchase-header h3 {
            margin: 0;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .purchase-body {
            padding: 25px;
        }

        .purchase-item-preview {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .purchase-item-icon {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 10px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .purchase-item-details {
            flex-grow: 1;
        }

        .purchase-item-details h4 {
            margin: 0 0 5px 0;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 18px;
        }

        .purchase-item-rarity {
            margin: 0 0 5px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .purchase-item-rarity.common { color: #95A5A6; }
        .purchase-item-rarity.uncommon { color: #3498DB; }
        .purchase-item-rarity.rare { color: #9B59B6; }
        .purchase-item-rarity.legendary { color: #F39C12; }
        .purchase-item-rarity.mythical { color: #E91E63; }
        .purchase-item-rarity.ultra_mythical { color: #9C27B0; }
        .purchase-item-rarity.godly { 
            background: linear-gradient(90deg, #FFD700, #FF4500, #FF1493, #8A2BE2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .purchase-item-stock {
            margin: 0;
            color: #BDC3C7;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }

        .purchase-price-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .purchase-price {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .purchase-balance, .purchase-remaining {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: white;
            margin: 5px 0;
        }

        .purchase-remaining #purchaseRemainingAmount {
            color: #4CAF50;
            font-weight: bold;
        }

        .purchase-remaining #purchaseRemainingAmount.negative {
            color: #E74C3C;
        }

        .purchase-buttons {
            display: flex;
            gap: 15px;
            padding: 0 25px 25px;
        }

        .purchase-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .purchase-confirm {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: 2px solid #1B5E20;
        }

        .purchase-confirm:hover {
            background: linear-gradient(135deg, #5CBF60, #388E3C);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
        }

        .purchase-cancel {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: 2px solid #A93226;
        }

        .purchase-cancel:hover {
            background: linear-gradient(135deg, #EC7063, #CD6155);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
        }

        .purchase-btn-icon {
            font-size: 18px;
        }

        /* Toast Notification Styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #34495E, #2C3E50);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            border: 2px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            z-index: 2000;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-success {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }

        .toast-error {
            border-color: #E74C3C;
            background: linear-gradient(135deg, #E74C3C, #C0392B);
        }

        .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .toast-message {
            flex-grow: 1;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="start-screen" id="startScreen">
        <h1> Grow A Beanstock </h1>
        <button class="start-button" id="startButton">Start Growing!</button>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="background"></div>
        
        <div class="clouds-container" id="cloudsContainer">
            <!-- Clouds will be dynamically added here -->
        </div>

        <div class="pots-container" id="potsContainer">
            <!-- 12 pots will be dynamically added here -->
        </div>

        <div class="grass-container"></div>

        <!-- UI Container -->
        <div class="ui-container" id="uiContainer">
            <div class="money-display">
                <span class="money-amount" id="moneyAmount">$1,234</span>
            </div>
            <button class="shop-button" id="shopButton">Shop</button>
            <button class="inventory-button" id="inventoryButton">Inventory</button>
        </div>
        
        <!-- Inventory Panel -->
        <div class="inventory-panel" id="inventoryPanel">
            <div class="inventory-header">
                <h2> Inventory</h2>
                <button class="inventory-close" id="inventoryClose"></button>
            </div>
            <div class="inventory-content">
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- Inventory items will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Inventory Overlay -->
        <div class="inventory-overlay" id="inventoryOverlay"></div>
        
        <!-- Shop Panel -->
        <div class="shop-panel" id="shopPanel">
            <div class="shop-header">
                <h2> Seed Shop</h2>
                <div class="shop-timer" id="shopTimer">
                    <span>Refreshes in: <span id="timerDisplay">3:00</span></span>
                </div>
                <button class="shop-close" id="shopClose"></button>
            </div>
            <div class="shop-content">
                <div class="shop-grid" id="shopGrid">
                    <!-- Shop items will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Shop Overlay -->
        <div class="shop-overlay" id="shopOverlay"></div>



        <!-- Purchase Confirmation Modal -->
        <div class="purchase-modal" id="purchaseModal">
            <div class="purchase-modal-content">
                <div class="purchase-header">
                    <h3> Confirm Purchase</h3>
                </div>
                <div class="purchase-body">
                    <div class="purchase-item-preview" id="purchaseItemPreview">
                        <div class="purchase-item-icon" id="purchaseItemIcon"></div>
                        <div class="purchase-item-details">
                            <h4 id="purchaseItemName">Item Name</h4>
                            <p class="purchase-item-rarity" id="purchaseItemRarity">Common</p>
                            <p class="purchase-item-stock" id="purchaseItemStock">Stock: 3</p>
                        </div>
                    </div>
                    <div class="purchase-price-section">
                        <div class="purchase-price" id="purchasePrice">$1,000</div>
                        <div class="purchase-balance">
                            <span>Your Balance: </span>
                            <span id="purchaseBalance">$5,000</span>
                        </div>
                        <div class="purchase-remaining" id="purchaseRemaining">
                            <span>After Purchase: </span>
                            <span id="purchaseRemainingAmount">$4,000</span>
                        </div>
                    </div>
                </div>
                <div class="purchase-buttons">
                    <button class="purchase-btn purchase-confirm" id="purchaseConfirm">
                        <span class="purchase-btn-icon"></span>
                        <span>Purchase</span>
                    </button>
                    <button class="purchase-btn purchase-cancel" id="purchaseCancel">
                        <span class="purchase-btn-icon"></span>
                        <span>Cancel</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="purchase-modal-overlay" id="purchaseModalOverlay"></div>
    </div>

    <script>
        class GameManager {
            constructor() {
                this.isFullscreen = false;
                this.clouds = [];
                this.pots = [];
                this.gameState = null;
                this.currentMoney = 100; // Starting money - will be updated from API
                this.plantData = this.initializePlantData();
                this.modifierData = this.initializeModifierData();
                this.playerInventory = [
                    { id: 1, name: 'Beanstalk', type: 'seed', rarity: 'common', quantity: 1, image: 'Assets/PlantSeeds/Beanstalkseeds.png' }
                ];
                this.isInventoryOpen = false;
                this.isShopOpen = false;
                this.shopInventory = [];
                this.shopData = null; // Current shop data from API
                this.shopTimer = null; // Shop refresh timer interval
                this.isDragging = false;
                this.draggedItem = null;
                this.dragElement = null;
                this.hoveredPot = null;
                this.growingPlants = new Map(); // Track growing plants by pot index
                this.seedTooltip = null; // For seed tooltips
                this.pendingPurchase = null; // Track current purchase being considered
                
                // Audio system - always enabled
                this.volume = 0.7;
                this.sounds = {};
                this.backgroundMusic = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.createPots();
                this.startCloudAnimation();
                this.initializeGameState();
            }

            // Initialize game state from API
            async initializeGameState() {
                try {
                    const response = await fetch('/api/game-state');
                    if (response.ok) {
                        const gameState = await response.json();
                        this.currentMoney = gameState.coins;
                        this.updateMoneyDisplay();
                        console.log('Game state initialized from API');
                    }
                } catch (error) {
                    console.log('Could not load game state from API, using defaults:', error);
                }
                
                // Start background shop refresh checking
                this.startBackgroundShopRefresh();
                
                // Initialize audio system
                this.initializeAudioSystem();
            }

            // Background shop refresh checking
            startBackgroundShopRefresh() {
                // Check for shop refreshes every 30 seconds
                setInterval(async () => {
                    try {
                        const response = await fetch('/api/shop');
                        if (response.ok) {
                            const newShopData = await response.json();
                            // If shop has refreshed and shop is currently open, update display
                            if (this.isShopOpen && this.shopData && 
                                newShopData.refresh_at !== this.shopData.refresh_at) {
                                this.shopData = newShopData;
                                this.populateShop();
                                console.log('Shop refreshed automatically');
                            } else if (!this.shopData) {
                                this.shopData = newShopData;
                            }
                        }
                    } catch (error) {
                        console.log('Background shop refresh check failed:', error);
                    }
                }, 30000);
            }

            setupEventListeners() {
                const startButton = document.getElementById('startButton');
                startButton.addEventListener('click', () => {
                    // Start background music on user interaction (bypasses autoplay restrictions)
                    this.startBackgroundMusic();
                    this.startGame();
                });
                
                const shopButton = document.getElementById('shopButton');
                shopButton.addEventListener('click', () => this.onShopClick());
                
                const inventoryButton = document.getElementById('inventoryButton');
                inventoryButton.addEventListener('click', () => this.onInventoryClick());
                
                const inventoryClose = document.getElementById('inventoryClose');
                inventoryClose.addEventListener('click', () => this.closeInventory());
                
                const inventoryOverlay = document.getElementById('inventoryOverlay');
                inventoryOverlay.addEventListener('click', () => this.closeInventory());
                
                const shopClose = document.getElementById('shopClose');
                shopClose.addEventListener('click', () => this.closeShop());
                
                const shopOverlay = document.getElementById('shopOverlay');
                shopOverlay.addEventListener('click', () => this.closeShop());
                
                // Add global drag event listeners
                document.addEventListener('mousemove', (e) => this.onMouseMove(e));
                document.addEventListener('mouseup', (e) => this.onMouseUp(e));

                // Purchase modal event listeners
                const purchaseConfirm = document.getElementById('purchaseConfirm');
                purchaseConfirm.addEventListener('click', () => this.confirmPurchase());
                
                const purchaseCancel = document.getElementById('purchaseCancel');
                purchaseCancel.addEventListener('click', () => this.cancelPurchase());
                
                const purchaseModalOverlay = document.getElementById('purchaseModalOverlay');
                purchaseModalOverlay.addEventListener('click', () => this.cancelPurchase());
                

            }

            async startGame() {
                try {
                    // Request fullscreen
                    await this.enterFullscreen();
                    
                    // Hide start screen and show game
                    document.getElementById('startScreen').classList.add('hidden');
                    document.getElementById('gameContainer').style.display = 'block';
                    
                    // Load initial game state
                    await this.loadGameState();
                    
                } catch (error) {
                    console.warn('Fullscreen not supported or denied, continuing anyway');
                    // Still start the game even if fullscreen fails
                    document.getElementById('startScreen').classList.add('hidden');
                    document.getElementById('gameContainer').style.display = 'block';
                    
                    // Load initial game state
                    await this.loadGameState();
                    
                    // Start background music immediately after game starts
                    this.startBackgroundMusic();
                }
            }

            async enterFullscreen() {
                const element = document.documentElement;
                
                if (element.requestFullscreen) {
                    await element.requestFullscreen();
                } else if (element.webkitRequestFullscreen) {
                    await element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) {
                    await element.msRequestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    await element.mozRequestFullScreen();
                }
                
                this.isFullscreen = true;
            }

            async loadGameState() {
                try {
                    const response = await fetch('/api/game-state');
                    this.gameState = await response.json();
                    this.updatePotVisuals();
                    console.log('Game state loaded:', this.gameState);
                } catch (error) {
                    console.error('Failed to load game state:', error);
                }
            }

            createPots() {
                const potsContainer = document.getElementById('potsContainer');
                
                for (let i = 0; i < 12; i++) {
                    const pot = document.createElement('div');
                    pot.className = 'pot';
                    pot.dataset.potIndex = i;
                    // Pot clicking disabled - only hover for growth info
                    // pot.addEventListener('click', () => this.onPotClick(i));
                    
                    // Add hover listeners for growth progress display
                    pot.addEventListener('mouseenter', () => this.onPotHover(i));
                    pot.addEventListener('mouseleave', () => this.onPotHoverEnd(i));
                    
                    potsContainer.appendChild(pot);
                    this.pots.push({
                        element: pot,
                        index: i,
                        state: 'empty'
                    });
                }
            }

            updatePotVisuals() {
                if (!this.gameState || !this.gameState.pots) return;
                
                this.gameState.pots.forEach((potData, index) => {
                    const potElement = this.pots[index].element;
                    potElement.className = `pot ${potData.state}`;
                    
                    // Update pot data
                    this.pots[index].state = potData.state;
                    this.pots[index].data = potData;
                });
            }

            // Pot hover to show growth progress
            onPotHover(index) {
                const potData = this.pots[index];
                
                if (potData && potData.state === 'growing') {
                    // Show growth progress tooltip
                    const plantData = this.growingPlants.get(index);
                    if (plantData) {
                        const elapsed = Date.now() - plantData.startTime;
                        const progress = Math.min((elapsed / plantData.growthTime) * 100, 100);
                        this.showGrowthTooltip(index, plantData.seedName, progress);
                    }
                }
            }

            onPotHoverEnd(index) {
                // Hide any tooltips
                this.hideGrowthTooltip();
            }

            showGrowthTooltip(potIndex, seedName, progress) {
                // Remove any existing tooltip
                this.hideGrowthTooltip();
                
                const pot = this.pots[potIndex].element;
                const potRect = pot.getBoundingClientRect();
                
                const tooltip = document.createElement('div');
                tooltip.id = 'growth-tooltip';
                tooltip.className = 'growth-tooltip';
                tooltip.innerHTML = `
                    <div class="tooltip-header">${seedName}</div>
                    <div class="tooltip-progress">Growth: ${progress.toFixed(1)}%</div>
                    <div class="tooltip-bar">
                        <div class="tooltip-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                // Position tooltip above the pot
                tooltip.style.position = 'fixed';
                tooltip.style.left = (potRect.left + potRect.width / 2) + 'px';
                tooltip.style.bottom = (window.innerHeight - potRect.top + 10) + 'px';
                tooltip.style.transform = 'translateX(-50%)';
                tooltip.style.zIndex = '1000';
                
                document.body.appendChild(tooltip);
            }

            hideGrowthTooltip() {
                const existing = document.getElementById('growth-tooltip');
                if (existing) {
                    existing.remove();
                }
            }

            // Legacy pot click function (disabled but kept for reference)
            async onPotClick(index) {
                // Pot clicking disabled - functionality moved to other interactions
                console.log(`Pot clicking disabled for pot ${index}`);
            }

            startCloudAnimation() {
                // Create initial clouds
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => this.createCloud(), i * 2000);
                }
                
                // Create new clouds more frequently
                setInterval(() => {
                    if (Math.random() > 0.4) { // 60% chance every interval
                        this.createCloud();
                    }
                }, 2000); // Check every 2 seconds
                
                // Additional cloud bursts occasionally
                setInterval(() => {
                    if (Math.random() > 0.8) { // 20% chance for burst
                        for (let i = 0; i < 2; i++) {
                            setTimeout(() => this.createCloud(), i * 1000);
                        }
                    }
                }, 8000); // Check every 8 seconds
            }

            createCloud() {
                const cloudsContainer = document.getElementById('cloudsContainer');
                const cloud = document.createElement('div');
                
                // Randomly choose between cloud.png and cloud2.png
                const cloudAsset = Math.random() > 0.5 ? 'cloud.png' : 'cloud2.png';
                cloud.style.backgroundImage = `url('Assets/${cloudAsset}')`;
                cloud.style.backgroundSize = 'contain';
                cloud.style.backgroundRepeat = 'no-repeat';
                cloud.style.position = 'absolute';
                cloud.style.width = '200px';
                cloud.style.height = '100px';
                
                // Random direction (left to right or right to left)
                const direction = Math.random() > 0.5 ? 'right' : 'left';
                cloud.className = `cloud moving-${direction}`;
                
                // Random vertical position (anywhere on screen, avoiding bottom 250px for grass/pots)
                const topPosition = Math.random() * (window.innerHeight - 250);
                cloud.style.top = `${topPosition}px`;
                
                // Set up dynamic scaling variables
                const startScale = 0.5 + Math.random() * 0.8; // 0.5 to 1.3
                const midScale = startScale + (Math.random() * 0.6 - 0.3); // 0.3 variation
                const endScale = startScale + (Math.random() * 0.4 - 0.2); // 0.2 variation
                
                // Set up drift variables for vertical movement
                const drift1 = (Math.random() * 40 - 20) + 'px'; // 20px
                const drift2 = (Math.random() * 60 - 30) + 'px'; // 30px
                
                // Apply CSS variables
                cloud.style.setProperty('--start-scale', startScale);
                cloud.style.setProperty('--mid-scale', Math.max(0.3, midScale));
                cloud.style.setProperty('--end-scale', Math.max(0.3, endScale));
                cloud.style.setProperty('--drift-1', drift1);
                cloud.style.setProperty('--drift-2', drift2);
                
                // Random opacity variation
                const opacity = 0.3 + Math.random() * 0.5; // 0.3 to 0.8
                cloud.style.opacity = opacity;
                
                // Random animation duration (20-45 seconds)
                const duration = 20 + Math.random() * 25;
                cloud.style.animationDuration = `${duration}s`;
                
                cloudsContainer.appendChild(cloud);
                this.clouds.push(cloud);
                
                // Remove cloud after animation completes
                setTimeout(() => {
                    if (cloud.parentNode) {
                        cloud.parentNode.removeChild(cloud);
                        const index = this.clouds.indexOf(cloud);
                        if (index > -1) {
                            this.clouds.splice(index, 1);
                        }
                    }
                }, duration * 1000);
            }

            // Money Management Methods
            updateMoneyDisplay() {
                const moneyElement = document.getElementById('moneyAmount');
                if (moneyElement) {
                    // Add changing animation
                    moneyElement.classList.add('changing');
                    
                    // Format money with commas
                    const formattedMoney = '$' + this.currentMoney.toLocaleString();
                    moneyElement.textContent = formattedMoney;
                    
                    // Remove animation class after animation completes
                    setTimeout(() => {
                        moneyElement.classList.remove('changing');
                    }, 500);
                }
            }



            // Update money from game state (for later use)
            updateMoneyFromGameState() {
                if (this.gameState && this.gameState.coins !== undefined) {
                    this.currentMoney = this.gameState.coins;
                    this.updateMoneyDisplay();
                }
            }

            // Shop functionality
            onShopClick() {
                console.log('Shop button clicked!');
                this.toggleShop();
            }

            toggleShop() {
                if (this.isShopOpen) {
                    this.closeShop();
                } else {
                    this.openShop();
                }
            }

            async openShop() {
                this.isShopOpen = true;
                document.getElementById('shopPanel').classList.add('active');
                document.getElementById('shopOverlay').classList.add('active');
                await this.loadShopData();
                this.populateShop();
                this.startShopTimer();
                console.log('Shop opened');
            }

            // API Functions
            async loadShopData() {
                try {
                    const response = await fetch('/api/shop');
                    if (response.ok) {
                        this.shopData = await response.json();
                        console.log('Shop data loaded:', this.shopData);
                    } else {
                        console.error('Failed to load shop data');
                        // Fallback to create local shop inventory if API fails
                        this.createShopInventory();
                    }
                } catch (error) {
                    console.error('Error loading shop data:', error);
                    this.createShopInventory();
                }
            }

            startShopTimer() {
                if (this.shopTimer) {
                    clearInterval(this.shopTimer);
                }
                
                this.shopTimer = setInterval(() => {
                    this.updateShopTimer();
                }, 1000);
                
                this.updateShopTimer(); // Update immediately
            }

            updateShopTimer() {
                console.log(' DEBUG: updateShopTimer called');
                
                if (!this.shopData || !this.shopData.refresh_at) {
                    console.log(' DEBUG: No shop data or refresh_at:', this.shopData);
                    return;
                }
                
                const now = Date.now() / 1000; // Current time in seconds
                const timeUntilRefresh = Math.max(0, this.shopData.refresh_at - now);
                
                console.log(` DEBUG: Timer - now: ${now}, refresh_at: ${this.shopData.refresh_at}, timeLeft: ${timeUntilRefresh}`);
                
                if (timeUntilRefresh <= 0) {
                    console.log(' DEBUG: Timer expired, refreshing shop');
                    // Shop should refresh
                    this.loadShopData().then(() => {
                        if (this.isShopOpen) {
                            this.populateShop();
                        }
                    });
                    return;
                }
                
                const minutes = Math.floor(timeUntilRefresh / 60);
                const seconds = Math.floor(timeUntilRefresh % 60);
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    const timerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    timerDisplay.textContent = timerText;
                    console.log(` DEBUG: Timer display updated: ${timerText}`);
                } else {
                    console.log(' DEBUG: Timer element not found');
                }
            }

            closeShop() {
                this.isShopOpen = false;
                document.getElementById('shopPanel').classList.remove('active');
                document.getElementById('shopOverlay').classList.remove('active');
                this.hideSeedTooltip(); // Hide tooltip when closing shop
                
                // Clear the shop timer when closing
                if (this.shopTimer) {
                    clearInterval(this.shopTimer);
                    this.shopTimer = null;
                }
                
                console.log('Shop closed');
            }

            populateShop() {
                const shopGrid = document.getElementById('shopGrid');
                shopGrid.innerHTML = '';

                console.log('Populating shop with shopData:', this.shopData);

                if (this.shopData && this.shopData.slots) {
                    // Use API data to populate shop
                    console.log('Using API data, slots:', this.shopData.slots);
                    this.shopData.slots.forEach((slot, index) => {
                        console.log(`Creating shop item for slot ${index}:`, slot);
                        const itemElement = this.createShopItemElement(slot, index);
                        shopGrid.appendChild(itemElement);
                    });
                } else {
                    console.log('Using fallback shop inventory');
                    // Fallback to hardcoded inventory if no API data
                    if (this.shopInventory.length === 0) {
                        this.createShopInventory();
                    }
                    this.shopInventory.forEach(item => {
                        const itemElement = this.createShopItemElement(item);
                        shopGrid.appendChild(itemElement);
                    });
                }
            }

            createShopInventory() {
                // Create one of each seed type for the shop
                this.shopInventory = [
                    { id: 1, name: 'Beanstalk', type: 'seed', rarity: 'common', price: 50, image: 'Assets/PlantSeeds/Beanstalkseeds.png', available: true },
                    { id: 2, name: 'Snap Pea', type: 'seed', rarity: 'common', price: 90, image: 'Assets/PlantSeeds/SnappeaSeeds.png', available: true },
                    { id: 3, name: 'Bamboo Bean', type: 'seed', rarity: 'common', price: 300, image: 'Assets/PlantSeeds/Bamboobeanseeds.png', available: true },
                    { id: 4, name: 'Jellybean Vine', type: 'seed', rarity: 'common', price: 170, image: 'Assets/PlantSeeds/jellybeanvineseeds.png', available: true },
                    { id: 5, name: 'Coffee Creeper', type: 'seed', rarity: 'common', price: 540, image: 'Assets/PlantSeeds/coffeebeanstalkseeds.png', available: true },
                    { id: 6, name: 'Frost Pea', type: 'seed', rarity: 'common', price: 1700, image: 'Assets/PlantSeeds/frostpeaseeds.png', available: true },
                    { id: 7, name: 'Thunder Pod', type: 'seed', rarity: 'uncommon', price: 970, image: 'Assets/PlantSeeds/thunderpodseeds.png', available: true },
                    { id: 8, name: 'Choco Vine', type: 'seed', rarity: 'uncommon', price: 3000, image: 'Assets/PlantSeeds/Chocovineseeds.png', available: true },
                    { id: 9, name: 'Iron Vine', type: 'seed', rarity: 'uncommon', price: 5300, image: 'Assets/PlantSeeds/Ironvineseeds.png', available: true },
                    { id: 10, name: 'Honey Vine', type: 'seed', rarity: 'uncommon', price: 9300, image: 'Assets/PlantSeeds/Honeyvineseeds.png', available: true },
                    { id: 11, name: 'Sunbean', type: 'seed', rarity: 'uncommon', price: 16000, image: 'Assets/PlantSeeds/Sunbeanseeds.png', available: true },
                    { id: 12, name: 'Moonbean', type: 'seed', rarity: 'uncommon', price: 28000, image: 'Assets/PlantSeeds/Moonbeanseeds.png', available: true },
                    { id: 13, name: 'Cloud Creeper', type: 'seed', rarity: 'uncommon', price: 49000, image: 'Assets/PlantSeeds/Cloudcreeperseeds.png', available: true },
                    { id: 14, name: 'Royal Stalk', type: 'seed', rarity: 'uncommon', price: 86000, image: 'Assets/PlantSeeds/Royalstalkseeds.png', available: true },
                    { id: 15, name: 'Crystal Bean', type: 'seed', rarity: 'rare', price: 150000, image: 'Assets/PlantSeeds/CrystalBeanseeds.png', available: true },
                    { id: 16, name: 'Neon Soy', type: 'seed', rarity: 'rare', price: 260000, image: 'Assets/PlantSeeds/Neonsoyseeds.png', available: true },
                    { id: 17, name: 'Vinecorn', type: 'seed', rarity: 'rare', price: 450000, image: 'Assets/PlantSeeds/Vinecornseeds.png', available: true },
                    { id: 18, name: 'Fire Pod', type: 'seed', rarity: 'rare', price: 780000, image: 'Assets/PlantSeeds/Firepodseeds.png', available: true },
                    { id: 19, name: 'Shadow Bean', type: 'seed', rarity: 'rare', price: 1350000, image: 'Assets/PlantSeeds/Shadowbeanseeds.png', available: true },
                    { id: 20, name: 'Prism Stalk', type: 'seed', rarity: 'legendary', price: 2340000, image: 'Assets/PlantSeeds/Prismstalkseeds.png', available: true },
                ];
            }

            createShopItemElement(item, slotIndex = null) {
                const itemDiv = document.createElement('div');
                
                console.log('Creating shop item element for:', item, 'slotIndex:', slotIndex);
                
                // Handle both API format (slot) and legacy format (item)
                const isApiFormat = item.species_id !== undefined;
                const name = isApiFormat ? item.species_name : item.name;
                const price = isApiFormat ? item.price : item.price;
                const rarity = isApiFormat ? item.rarity : item.rarity;
                const stock = isApiFormat ? item.stock : null;
                const available = isApiFormat ? (item.stock > 0) : item.available;
                const image = isApiFormat ? this.getSeedImageForSpecies(item.species_id) : item.image;
                
                console.log(`Item details - name: ${name}, price: ${price}, stock: ${stock}, available: ${available}`);
                
                const canAfford = this.currentMoney >= price;
                const availabilityClass = available && canAfford ? 'available' : 'unavailable';
                
                itemDiv.className = `shop-item ${availabilityClass} rarity-${rarity}`;
                itemDiv.onclick = () => this.onShopItemClick(isApiFormat ? { ...item, slotIndex } : item);

                // Always show price
                const priceContent = `<div class="shop-item-price">$${price.toLocaleString()}</div>`;
                
                // Show availability status if there's an issue
                const statusContent = (!available || !canAfford) ? 
                    `<div class="shop-item-status ${!available ? 'out-of-stock' : 'too-expensive'}">${!canAfford ? 'TOO EXPENSIVE!' : stock === 0 ? 'OUT OF STOCK!' : 'UNAVAILABLE'}</div>` : '';

                // Stock display for API format - lowered threshold for low stock warning
                const stockContent = isApiFormat ? 
                    `<div class="shop-item-stock ${stock <= 1 ? 'low-stock' : ''}">Stock: ${stock}</div>` : '';

                itemDiv.innerHTML = `
                    <div class="shop-item-icon" style="background-image: url('${image}')"></div>
                    <h3 style="color: white; font-size: 14px; margin: 5px 0; text-align: center;">${name}</h3>
                    ${priceContent}
                    ${statusContent}
                    ${stockContent}
                `;

                return itemDiv;
            }

            // Map species IDs to seed images
            getSeedImageForSpecies(speciesId) {
                const seedImageMap = {
                    'beanstalk': 'Assets/PlantSeeds/Beanstalkseeds.png',
                    'snap_pea': 'Assets/PlantSeeds/SnappeaSeeds.png',
                    'jellybean_vine': 'Assets/PlantSeeds/jellybeanvineseeds.png',
                    'bamboo_bean': 'Assets/PlantSeeds/Bamboobeanseeds.png',
                    'coffee_beanstalk': 'Assets/PlantSeeds/coffeebeanstalkseeds.png',
                    'thunder_pod': 'Assets/PlantSeeds/thunderpodseeds.png',
                    'frost_pea': 'Assets/PlantSeeds/frostpeaseeds.png',
                    'choco_vine': 'Assets/PlantSeeds/Chocovineseeds.png',
                    'ironvine': 'Assets/PlantSeeds/Ironvineseeds.png',
                    'honeyvine': 'Assets/PlantSeeds/Honeyvineseeds.png',
                    'sunbean': 'Assets/PlantSeeds/Sunbeanseeds.png',
                    'moonbean': 'Assets/PlantSeeds/Moonbeanseeds.png',
                    'cloud_creeper': 'Assets/PlantSeeds/Cloudcreeperseeds.png',
                    'royal_stalk': 'Assets/PlantSeeds/Royalstalkseeds.png',
                    'crystal_bean': 'Assets/PlantSeeds/CrystalBeanseeds.png',
                    'neon_soy': 'Assets/PlantSeeds/Neonsoyseeds.png',
                    'vinecorn': 'Assets/PlantSeeds/Vinecornseeds.png',
                    'fire_pod': 'Assets/PlantSeeds/Firepodseeds.png',
                    'shadow_bean': 'Assets/PlantSeeds/Shadowbeanseeds.png',
                    'prism_stalk': 'Assets/PlantSeeds/Prismstalkseeds.png'
                };
                return seedImageMap[speciesId] || 'Assets/PlantSeeds/Beanstalkseeds.png'; // Fallback
            }

            onShopItemClick(item) {
                console.log('Shop item clicked:', item);
                
                // Handle both API format (has slotIndex) and legacy format
                const isApiFormat = item.slotIndex !== undefined;
                const name = isApiFormat ? item.species_name : item.name;
                const price = item.price;
                const available = isApiFormat ? (item.stock > 0) : item.available;
                
                if (!available) {
                    // Item is unavailable, but still show modal so they can see the price
                    this.showPurchaseModal(item);
                    return;
                }
                
                // Show purchase modal even if can't afford - let them see the price
                this.showPurchaseModal(item);
            }

            showPurchaseModal(item) {
                // Handle both API format and legacy format
                const isApiFormat = item.slotIndex !== undefined;
                const name = isApiFormat ? item.species_name : item.name;
                const price = item.price;
                const rarity = isApiFormat ? item.rarity : item.rarity;
                const stock = isApiFormat ? item.stock : null;
                const image = isApiFormat ? this.getSeedImageForSpecies(item.species_id) : item.image;
                const available = isApiFormat ? (item.stock > 0) : item.available;
                
                // Store the pending purchase
                this.pendingPurchase = {
                    item,
                    isApiFormat,
                    name,
                    price,
                    available,
                    canAfford: this.currentMoney >= price
                };
                
                // Populate modal content
                document.getElementById('purchaseItemIcon').style.backgroundImage = `url('${image}')`;
                document.getElementById('purchaseItemName').textContent = name;
                
                const rarityElement = document.getElementById('purchaseItemRarity');
                rarityElement.textContent = rarity.charAt(0).toUpperCase() + rarity.slice(1).replace('_', '-');
                rarityElement.className = `purchase-item-rarity ${rarity}`;
                
                document.getElementById('purchaseItemStock').textContent = stock ? `Stock: ${stock}` : '';
                document.getElementById('purchasePrice').textContent = `$${price.toLocaleString()}`;
                document.getElementById('purchaseBalance').textContent = `$${this.currentMoney.toLocaleString()}`;
                
                const remainingAmount = this.currentMoney - price;
                const remainingElement = document.getElementById('purchaseRemainingAmount');
                remainingElement.textContent = `$${remainingAmount.toLocaleString()}`;
                remainingElement.className = remainingAmount < 0 ? 'negative' : '';
                
                // Update confirm button based on affordability and availability
                const confirmButton = document.getElementById('purchaseConfirm');
                if (!available) {
                    confirmButton.textContent = 'Out of Stock';
                    confirmButton.disabled = true;
                    confirmButton.style.opacity = '0.5';
                } else if (!this.pendingPurchase.canAfford) {
                    confirmButton.innerHTML = '<span class="purchase-btn-icon"></span><span>Can\'t Afford</span>';
                    confirmButton.disabled = true;
                    confirmButton.style.opacity = '0.5';
                } else {
                    confirmButton.innerHTML = '<span class="purchase-btn-icon"></span><span>Purchase</span>';
                    confirmButton.disabled = false;
                    confirmButton.style.opacity = '1';
                }
                
                // Show modal
                document.getElementById('purchaseModal').classList.add('active');
                document.getElementById('purchaseModalOverlay').classList.add('active');
            }

            cancelPurchase() {
                // Hide modal
                document.getElementById('purchaseModal').classList.remove('active');
                document.getElementById('purchaseModalOverlay').classList.remove('active');
                
                // Clear pending purchase
                this.pendingPurchase = null;
            }

            async confirmPurchase() {
                if (!this.pendingPurchase || !this.pendingPurchase.canAfford || !this.pendingPurchase.available) {
                    return;
                }
                
                console.log('Confirming purchase for:', this.pendingPurchase);
                
                // Process the purchase
                if (this.pendingPurchase.isApiFormat) {
                    await this.purchaseItemFromAPI(this.pendingPurchase.item);
                } else {
                    this.purchaseItem(this.pendingPurchase.item);
                }
                
                // Hide modal after purchase
                this.cancelPurchase();
            }

            purchaseItem(item) {
                // Deduct money
                this.currentMoney -= item.price;
                this.updateMoneyDisplay();
                
                // Add to player inventory
                const existingItem = this.playerInventory.find(invItem => invItem.name === item.name);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    this.playerInventory.push({
                        id: Date.now(), // Simple ID generation
                        name: item.name,
                        type: item.type,
                        rarity: item.rarity,
                        quantity: 1,
                        image: item.image
                    });
                }
                
                // Update shop display to reflect affordability changes
                this.populateShop();
                
                // Update inventory display if it's open
                if (this.isInventoryOpen) {
                    this.populateInventory();
                }
                
                console.log(`Purchased ${item.name} for $${item.price}`);
                this.showSuccessMessage(`Successfully purchased ${item.name}! Check your inventory.`);
            }

            async purchaseItemFromAPI(item) {
                try {
                    const response = await fetch('/api/buy-seed', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            slot_index: item.slotIndex,
                            pot_index: -1 // -1 means add to inventory instead of planting directly
                        })
                    });

                    const result = await response.json();
                    
                    console.log(' DEBUG: API Response:', result);
                    console.log(' DEBUG: Response success:', result.success);
                    console.log(' DEBUG: Response coins:', result.coins);
                    
                    if (result.success) {
                        console.log(`Successfully purchased ${item.species_name}!`);
                        console.log('Purchase result:', result);
                        
                        // Update local money from server response
                        this.currentMoney = result.coins;
                        this.updateMoneyDisplay();
                        
                        // Add to inventory
                        const existingItem = this.playerInventory.find(invItem => invItem.name === item.species_name);
                        if (existingItem) {
                            existingItem.quantity += 1;
                            console.log(`Updated existing item: ${item.species_name}, new quantity: ${existingItem.quantity}`);
                        } else {
                            const newItem = {
                                id: Date.now(),
                                name: item.species_name,
                                type: 'seed',
                                rarity: item.rarity,
                                quantity: 1,
                                image: this.getSeedImageForSpecies(item.species_id)
                            };
                            this.playerInventory.push(newItem);
                            console.log(`Added new item to inventory:`, newItem);
                        }
                        
                        // Use the shop data returned from the purchase instead of making another API call
                        if (result.shop) {
                            this.shopData = result.shop;
                            console.log('Updated shop data from purchase response:', this.shopData);
                        }
                        this.populateShop();
                        
                        // Update inventory display if it's open
                        if (this.isInventoryOpen) {
                            this.populateInventory();
                        }
                        
                        console.log('Current inventory after purchase:', this.playerInventory);
                        this.showSuccessMessage(`Successfully purchased ${item.species_name}! Check your inventory.`);
                    } else {
                        this.showErrorMessage('Purchase failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Error purchasing item:', error);
                    this.showErrorMessage('Purchase failed. Please check your connection and try again.');
                }
            }

            // Notification system
            showSuccessMessage(message) {
                console.log('SUCCESS:', message);
                this.showToast(message, 'success');
            }

            showErrorMessage(message) {
                console.error('ERROR:', message);
                this.showToast(message, 'error');
            }

            showToast(message, type = 'info') {
                // Create toast element
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">${type === 'success' ? '' : type === 'error' ? '' : ''}</div>
                    <div class="toast-message">${message}</div>
                `;

                // Add to page
                document.body.appendChild(toast);

                // Animate in
                setTimeout(() => toast.classList.add('show'), 100);

                // Remove after delay
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // Inventory functionality
            onInventoryClick() {
                console.log('Inventory button clicked!');
                this.toggleInventory();
            }

            toggleInventory() {
                if (this.isInventoryOpen) {
                    this.closeInventory();
                } else {
                    this.openInventory();
                }
            }

            openInventory() {
                this.isInventoryOpen = true;
                document.getElementById('inventoryPanel').classList.add('active');
                document.getElementById('inventoryOverlay').classList.add('active');
                this.populateInventory();
                console.log('Inventory opened');
            }

            closeInventory() {
                this.isInventoryOpen = false;
                document.getElementById('inventoryPanel').classList.remove('active');
                document.getElementById('inventoryOverlay').classList.remove('active');
                this.hideSeedTooltip(); // Hide tooltip when closing inventory
                console.log('Inventory closed');
            }

            populateInventory() {
                const inventoryGrid = document.getElementById('inventoryGrid');
                inventoryGrid.innerHTML = '';

                // No longer using dummy data - player starts with one beanstalk seed

                console.log('Populating inventory with playerInventory:', this.playerInventory);

                // Populate the grid with inventory items
                if (this.playerInventory.length === 0) {
                    console.log('Inventory is empty, showing empty message');
                    // Show empty inventory message
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'inventory-empty';
                    emptyMessage.innerHTML = `
                        <div class="inventory-empty-icon"></div>
                        <p>Your inventory is empty!</p>
                        <p>Buy some seeds from the shop to get started.</p>
                    `;
                    inventoryGrid.appendChild(emptyMessage);
                } else {
                    console.log(`Showing ${this.playerInventory.length} inventory items`);
                    // Show inventory items
                    this.playerInventory.forEach((item, index) => {
                        console.log(`Creating inventory item ${index}:`, item);
                        const itemElement = this.createInventoryItemElement(item);
                        inventoryGrid.appendChild(itemElement);
                    });
                }
            }



            createInventoryItemElement(item) {
                const itemDiv = document.createElement('div');
                itemDiv.className = `inventory-item ${item.type} rarity-${item.rarity}`;
                
                // Add drag functionality
                itemDiv.addEventListener('mousedown', (e) => {
                    console.log(' DEBUG: mousedown on inventory item:', item.name);
                    this.startDragging(e, item, itemDiv);
                });
                itemDiv.onclick = (e) => {
                    // Only trigger click if not dragging
                    if (!this.isDragging) {
                        this.onInventoryItemClick(item);
                    }
                };

                // Add tooltip functionality
                itemDiv.addEventListener('mouseenter', (e) => {
                    if (!this.isDragging) {
                        const rect = itemDiv.getBoundingClientRect();
                        this.showSeedTooltip(item, rect.right + 10, rect.top + rect.height / 2);
                    }
                });

                itemDiv.addEventListener('mouseleave', () => {
                    this.hideSeedTooltip();
                });

                // Use image if available, fallback to icon
                const iconContent = item.image 
                    ? `<div class="inventory-item-icon" style="background-image: url('${item.image}')"></div>`
                    : `<div class="inventory-item-icon">${item.icon || ''}</div>`;

                itemDiv.innerHTML = `
                    ${iconContent}
                    <div class="inventory-item-quantity"> ${item.quantity}</div>
                `;

                return itemDiv;
            }

            onInventoryItemClick(item) {
                console.log('Inventory item clicked:', item);
                // TODO: Implement item interaction (planting, selling, etc.)
                alert(`Selected: ${item.name}\nQuantity: ${item.quantity}\nRarity: ${item.rarity}`);
            }

            // Drag and Drop Methods
            startDragging(e, item, sourceElement) {
                e.preventDefault();
                
                console.log(' DEBUG: startDragging called');
                console.log(' DEBUG: Item:', item);
                console.log(' DEBUG: Mouse position:', e.clientX, e.clientY);
                
                this.isDragging = true;
                this.draggedItem = { ...item }; // Clone the item
                
                // Hide tooltip immediately when dragging starts
                this.hideSeedTooltip();
                
                // Add dragging class to source element
                sourceElement.classList.add('dragging');
                
                // Create drag visual
                this.createDragElement(item);
                
                // Close inventory
                this.closeInventory();
                
                // Update inventory immediately (decrease quantity or remove)
                this.updateInventoryForDrag(item);
                
                console.log(` DEBUG: Started dragging: ${item.name}, isDragging: ${this.isDragging}`);
            }

            createDragElement(item) {
                console.log(' DEBUG: createDragElement called');
                this.dragElement = document.createElement('div');
                this.dragElement.className = `dragging-seed rarity-${item.rarity}`;
                this.dragElement.style.backgroundImage = `url('${item.image}')`;
                this.dragElement.style.pointerEvents = 'none';
                
                document.body.appendChild(this.dragElement);
                console.log(' DEBUG: Drag element created and added to body');
                console.log(' DEBUG: Element classes:', this.dragElement.className);
            }

            onMouseMove(e) {
                if (!this.isDragging || !this.dragElement) return;
                
                // Update drag element position
                this.dragElement.style.left = e.clientX + 'px';
                this.dragElement.style.top = e.clientY + 'px';
                
                // Check if we're over a pot for visual feedback
                this.checkPotHover(e);
            }

            checkPotHover(e) {
                // Get element under cursor (drag element already has pointer-events: none)
                const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
                
                // Check if we're over a pot
                const potElement = elementBelow?.closest('.pot');
                
                if (potElement) {
                    const potIndex = parseInt(potElement.dataset.potIndex);
                    const potData = this.pots[potIndex];
                    
                    // Check if pot is empty - just highlight, no pouring yet
                    if (potData && potData.state === 'empty') {
                        if (this.hoveredPot !== potIndex) {
                            this.hoveredPot = potIndex;
                            potElement.classList.add('drag-hover');
                        }
                    } else {
                        // Over a non-empty pot - remove effects
                        this.clearPotHover();
                    }
                } else {
                    // Not over any pot - remove effects
                    this.clearPotHover();
                }
            }

            clearPotHover() {
                if (this.hoveredPot !== null) {
                    // Remove hover effect from pot
                    const potElement = document.querySelector(`[data-pot-index="${this.hoveredPot}"]`);
                    if (potElement) {
                        potElement.classList.remove('drag-hover');
                    }
                    
                    this.hoveredPot = null;
                }
            }

            onMouseUp(e) {
                console.log(' DEBUG: onMouseUp called');
                console.log(' DEBUG: isDragging:', this.isDragging);
                console.log(' DEBUG: draggedItem:', this.draggedItem?.name);
                console.log(' DEBUG: Mouse position:', e.clientX, e.clientY);
                
                if (!this.isDragging) {
                    console.log(' DEBUG: Not dragging, returning early');
                    return;
                }
                
                console.log(` DEBUG: Dropped seed: ${this.draggedItem.name} at position ${e.clientX}, ${e.clientY}`);
                
                // Check if we're dropping over an empty pot
                const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
                console.log(' DEBUG: Element below on drop:', elementBelow?.tagName, elementBelow?.className);
                
                const potElement = elementBelow?.closest('.pot');
                console.log(' DEBUG: Found pot element:', !!potElement, potElement?.dataset?.potIndex);
                
                if (potElement) {
                    const potIndex = parseInt(potElement.dataset.potIndex);
                    const potData = this.pots[potIndex];
                    
                    console.log(' DEBUG: Pot index:', potIndex, 'Pot data:', potData);
                    
                    // Check if pot is empty
                    if (potData && potData.state === 'empty') {
                        console.log(' DEBUG: Valid drop! Planting', this.draggedItem.name, 'in pot', potIndex);
                        this.plantSeedInPot(potIndex);
                        return; // plantSeedInPot will handle ending the drag
                    } else {
                        console.log(' DEBUG: Pot not empty, state:', potData?.state);
                    }
                } else {
                    console.log(' DEBUG: No pot element found');
                }
                
                // If we get here, it's not a valid drop - just end dragging
                console.log(' DEBUG: Invalid drop location, ending drag');
                this.endDragging();
            }

            endDragging() {
                this.isDragging = false;
                
                // Clear pot hover effects
                this.clearPotHover();
                
                // Remove drag element
                if (this.dragElement) {
                    // Make sure to remove any pouring class before removing element
                    this.dragElement.classList.remove('pouring');
                    this.dragElement.remove();
                    this.dragElement = null;
                }
                
                // Clear dragging state
                this.draggedItem = null;
                
                // Remove dragging class from any elements
                document.querySelectorAll('.inventory-item.dragging').forEach(el => {
                    el.classList.remove('dragging');
                });
                
                // Remove any lingering drag-hover classes from pots
                document.querySelectorAll('.pot.drag-hover').forEach(el => {
                    el.classList.remove('drag-hover');
                });
                
                console.log('Drag ended');
            }

            updateInventoryForDrag(item) {
                const inventoryItem = this.playerInventory.find(invItem => invItem.id === item.id);
                
                if (!inventoryItem) return;
                
                if (inventoryItem.quantity > 1) {
                    // Decrease quantity by 1
                    inventoryItem.quantity -= 1;
                } else {
                    // Remove item completely
                    const index = this.playerInventory.indexOf(inventoryItem);
                    this.playerInventory.splice(index, 1);
                }
                
                console.log(`Updated inventory: ${item.name} - Remaining quantity: ${inventoryItem ? inventoryItem.quantity : 0}`);
            }

            plantSeedInPot(potIndex) {
                console.log(' DEBUG: plantSeedInPot called with potIndex:', potIndex);
                console.log(' DEBUG: dragElement exists:', !!this.dragElement);
                console.log(' DEBUG: draggedItem:', this.draggedItem?.name);
                
                // Clear pot hover effects first
                this.clearPotHover();
                
                // Add pouring animation to the seed
                if (this.dragElement) {
                    console.log(' DEBUG: Adding pouring class to dragElement');
                    console.log(' DEBUG: dragElement classes before:', this.dragElement.className);
                    this.dragElement.classList.add('pouring');
                    console.log(' DEBUG: dragElement classes after:', this.dragElement.className);
                } else {
                    console.log(' DEBUG: No dragElement found!');
                }
                
                // Get the pot element for visual feedback
                const potElement = document.querySelector(`[data-pot-index="${potIndex}"]`);
                console.log(' DEBUG: Found potElement:', !!potElement);
                if (potElement) {
                    potElement.classList.add('drag-hover');
                }
                
                console.log(' DEBUG: Starting 300ms timeout for planting animation');
                
                // Wait for the pouring animation, then plant the seed
                setTimeout(() => {
                    console.log(' DEBUG: Timeout completed, starting vine growth');
                    
                    // Start growing the vine
                    this.startVineGrowth(potIndex, this.draggedItem.name);
                    
                    console.log(` DEBUG: Successfully planted ${this.draggedItem.name} in pot ${potIndex}`);
                    
                    // End the dragging operation
                    this.endDragging();
                    
                }, 300); // Wait 300ms for the pouring animation
            }

            startVineGrowth(potIndex, seedName) {
                console.log(' DEBUG: startVineGrowth called for', seedName, 'in pot', potIndex);
                
                const growthData = this.getPlantGrowthData()[seedName];
                if (!growthData) {
                    console.error(' DEBUG: No growth data found for', seedName);
                    return;
                }
                
                console.log(' DEBUG: Growth data:', growthData);
                
                // Update pot state
                if (this.pots[potIndex]) {
                    this.pots[potIndex].state = 'growing';
                    this.pots[potIndex].data = {
                        state: 'growing',
                        seedName: seedName,
                        plantedTime: Date.now()
                    };
                }
                
                // Create vine element
                const vineElement = document.createElement('div');
                vineElement.className = 'vine growing';
                vineElement.style.backgroundImage = `url('${growthData.vineImage}')`;
                vineElement.style.animationDuration = `${growthData.growthTime}s`;
                
                // Position vine relative to pot
                const potElement = document.querySelector(`[data-pot-index="${potIndex}"]`);
                if (potElement) {
                    // Position vine in same container as pots but absolutely positioned over the specific pot
                    const potsContainer = document.getElementById('potsContainer');
                    if (potsContainer) {
                        // Get pot position relative to container
                        const potRect = potElement.getBoundingClientRect();
                        const containerRect = potsContainer.getBoundingClientRect();
                        
                        vineElement.style.left = (potRect.left - containerRect.left + potRect.width/2) + 'px';
                        vineElement.style.transform = 'translateX(-50%) scale(0.3, 0)';
                        
                        potsContainer.appendChild(vineElement);
                        console.log(' DEBUG: Vine element created and positioned at pot', potIndex);
                        
                        // Add animation end listener to ensure smooth transition
                        vineElement.addEventListener('animationend', () => {
                            console.log(' DEBUG: Growth animation completed for pot', potIndex);
                            // Force the grown state if animation completes
                            if (vineElement.classList.contains('growing')) {
                                vineElement.classList.remove('growing');
                                vineElement.classList.add('grown');
                                vineElement.style.transform = 'translateX(-50%) scale(1, 1)';
                                console.log(' DEBUG: Forced vine to grown state after animation');
                            }
                        });
                    }
                }
                
                // Track growing plant
                this.growingPlants.set(potIndex, {
                    vineElement: vineElement,
                    seedName: seedName,
                    startTime: Date.now(),
                    growthTime: growthData.growthTime * 1000, // Convert to milliseconds
                    ready: false
                });
                
                // Set timer for when plant is ready
                setTimeout(() => {
                    this.makeVineReady(potIndex);
                }, growthData.growthTime * 1000);
                
                console.log(` DEBUG: Started growing ${seedName} for ${growthData.growthTime} seconds`);
            }

            makeVineReady(potIndex) {
                console.log(' DEBUG: makeVineReady called for pot', potIndex);
                
                const plantData = this.growingPlants.get(potIndex);
                if (!plantData) {
                    console.error(' DEBUG: No growing plant found for pot', potIndex);
                    return;
                }
                
                // Update vine visual state - vine stays fully grown but gets golden glow
                if (plantData.vineElement) {
                    plantData.vineElement.classList.remove('growing');
                    plantData.vineElement.classList.add('grown', 'ready');
                    console.log(' DEBUG: Vine is now fully grown and ready to harvest!');
                    console.log(' DEBUG: Vine element classes:', plantData.vineElement.className);
                    console.log(' DEBUG: Vine element style:', plantData.vineElement.style.transform);
                    
                    //  SPAWN BEANS AROUND THE GROWN VINE!
                    this.spawnBeansAroundVine(potIndex, plantData.seedName, plantData.vineElement);
                }
                
                // Update pot state
                if (this.pots[potIndex]) {
                    this.pots[potIndex].state = 'ready';
                    this.pots[potIndex].data.state = 'ready';
                    
                    const potElement = document.querySelector(`[data-pot-index="${potIndex}"]`);
                    if (potElement) {
                        potElement.className = 'pot ready';
                    }
                }
                
                // Update plant data
                plantData.ready = true;
                this.growingPlants.set(potIndex, plantData);
                
                console.log(` DEBUG: ${plantData.seedName} in pot ${potIndex} is ready for harvest!`);
            }

            harvestPlant(potIndex) {
                console.log(' DEBUG: harvestPlant called for pot', potIndex);
                
                const plantData = this.growingPlants.get(potIndex);
                if (!plantData) {
                    console.error(' DEBUG: No plant data found for pot', potIndex);
                    return;
                }
                
                //  REMOVE BEANS FIRST!
                this.removeBeansFromVine(potIndex);
                
                // Remove vine element
                if (plantData.vineElement) {
                    plantData.vineElement.remove();
                    console.log(' DEBUG: Vine element removed');
                }
                
                // Reset pot state
                if (this.pots[potIndex]) {
                    this.pots[potIndex].state = 'empty';
                    this.pots[potIndex].data = { state: 'empty' };
                    
                    const potElement = document.querySelector(`[data-pot-index="${potIndex}"]`);
                    if (potElement) {
                        potElement.className = 'pot';
                    }
                }
                
                // Remove from growing plants tracking
                this.growingPlants.delete(potIndex);
                
                // TODO: Add harvested plant to inventory or give coins
                console.log(` DEBUG: Harvested ${plantData.seedName} from pot ${potIndex}!`);
                alert(`Harvested ${plantData.seedName}! \n\n(Harvesting rewards coming soon!)`);
            }

            // Plant growth data and vine mapping
            getPlantGrowthData() {
                return {
                    'Beanstalk': { growthTime: 25, vineImage: 'Assets/Vines/Beanstalkvine.png', type: 'Picker' },
                    'Snap Pea': { growthTime: 75, vineImage: 'Assets/Vines/peaseedvine.png', type: 'Picker' },
                    'Jellybean Vine': { growthTime: 90, vineImage: 'Assets/Vines/Jellybeanvine.png', type: 'Picker' },
                    'Bamboo Bean': { growthTime: 120, vineImage: 'Assets/Vines/bamboovine.png', type: 'Cutter' },
                    'Coffee Creeper': { growthTime: 120, vineImage: 'Assets/Vines/Coffebeanvine.png', type: 'Picker' },
                    'Thunder Pod': { growthTime: 150, vineImage: 'Assets/Vines/Thunderpodvine.png', type: 'Cutter' },
                    'Frost Pea': { growthTime: 150, vineImage: 'Assets/Vines/frostvine.png', type: 'Picker' },
                    'Choco Vine': { growthTime: 180, vineImage: 'Assets/Vines/Chocovine.png', type: 'Picker' },
                    'Iron Vine': { growthTime: 210, vineImage: 'Assets/Vines/Ironvine.png', type: 'Cutter' },
                    'Honey Vine': { growthTime: 180, vineImage: 'Assets/Vines/Honeyvine.png', type: 'Picker' },
                    'Sunbean': { growthTime: 240, vineImage: 'Assets/Vines/Sunbeanvine.png', type: 'Picker' },
                    'Moonbean': { growthTime: 240, vineImage: 'Assets/Vines/moonbeanvine.png', type: 'Picker' },
                    'Cloud Creeper': { growthTime: 270, vineImage: 'Assets/Vines/Cloudvine.png', type: 'Picker' },
                    'Royal Stalk': { growthTime: 300, vineImage: 'Assets/Vines/Royalstalkvine.png', type: 'Cutter' },
                    'Crystal Bean': { growthTime: 300, vineImage: 'Assets/Vines/Crystalbeanvine.png', type: 'Picker' },
                    'Neon Soy': { growthTime: 330, vineImage: 'Assets/Vines/Neonsoyvine.png', type: 'Cutter' },
                    'Vinecorn': { growthTime: 240, vineImage: 'Assets/Vines/Cornvine.png', type: 'Cutter' },
                    'Fire Pod': { growthTime: 360, vineImage: 'Assets/Vines/Firepodvine.png', type: 'Cutter' },
                    'Shadow Bean': { growthTime: 300, vineImage: 'Assets/Vines/Shadowbeanvine.png', type: 'Picker' },
                    'Prism Stalk': { growthTime: 480, vineImage: 'Assets/Vines/Prysmvine.png', type: 'Picker' }
                };
            }

            // Bean mapping for different plant types
            getBeanImageForPlant(plantName) {
                const beanMapping = {
                    'Beanstalk': 'Assets/BasicBeans/beanstalkbean.png', // Correct bean for basic beanstalk
                    'Snap Pea': 'Assets/BasicBeans/Snappeabean.png',
                    'Jellybean Vine': 'Assets/BasicBeans/Jellybean.png',
                    'Bamboo Bean': 'Assets/BasicBeans/Bamboobean.png',
                    'Coffee Creeper': 'Assets/BasicBeans/Coffebean.png',
                    'Thunder Pod': 'Assets/BasicBeans/Thunderboltpeabean.png',
                    'Frost Pea': 'Assets/BasicBeans/Frostbean.png',
                    'Choco Vine': 'Assets/BasicBeans/Chocobean.png',
                    'Iron Vine': 'Assets/BasicBeans/Ironbean.png',
                    'Honey Vine': 'Assets/BasicBeans/Honeybean.png',
                    'Sunbean': 'Assets/BasicBeans/Sunbean.png',
                    'Moonbean': 'Assets/BasicBeans/Moombean.png',
                    'Cloud Creeper': 'Assets/BasicBeans/Cloudbean.png',
                    'Royal Stalk': 'Assets/BasicBeans/Royalbean.png',
                    'Crystal Bean': 'Assets/BasicBeans/Crystalbean.png',
                    'Neon Soy': 'Assets/BasicBeans/Neonbean.png',
                    'Vinecorn': 'Assets/BasicBeans/Cornbean.png',
                    'Fire Pod': 'Assets/BasicBeans/Firebean.png',
                    'Shadow Bean': 'Assets/BasicBeans/Shadowbean.png',
                    'Prism Stalk': 'Assets/BasicBeans/Prysmbean.png'
                };
                
                return beanMapping[plantName] || 'Assets/BasicBeans/Jellybean.png'; // Default fallback
            }

            // Bean value mapping based on plant types with rarity multipliers
            getBeanValueForPlant(plantName, rarity = 'none') {
                const beanValues = {
                    'Beanstalk': () => 12 + Math.floor(Math.random() * 5), // 12-16 random
                    'Snap Pea': 90,
                    'Jellybean Vine': 170,
                    'Bamboo Bean': 300,
                    'Coffee Creeper': 540,
                    'Thunder Pod': 970,
                    'Frost Pea': 2700,
                    'Choco Vine': 3500,
                    'Iron Vine': 15300,
                    'Honey Vine': 19300,
                    'Sunbean': 25500,
                    'Moonbean': 43000,
                    'Cloud Creeper': 49000,
                    'Royal Stalk': 86000,
                    'Crystal Bean': 120000,
                    'Neon Soy': 160000,
                    'Vinecorn': 210000,
                    'Fire Pod': 280000,
                    'Shadow Bean': 320000,
                    'Prism Stalk': 340000
                };
                
                let baseValue = beanValues[plantName];
                if (typeof baseValue === 'function') {
                    baseValue = baseValue();
                } else if (!baseValue) {
                    baseValue = 10;
                }
                
                // Apply rarity multipliers
                let multiplier = 1.0;
                if (rarity === 'shiny') {
                    multiplier = 3.0; // 200% more valuable (3x multiplier)
                } else if (rarity === 'golden') {
                    multiplier = 6.0; // 500% more valuable (6x multiplier)
                }
                
                const finalValue = Math.floor(baseValue * multiplier);
                
                // Log special beans for excitement!
                if (rarity !== 'none') {
                    const rarityName = rarity === 'shiny' ? 'SILVER SHINY' : 'GOLDEN';
                    console.log(` ${rarityName} BEAN! ${plantName} worth ${finalValue} coins (${multiplier}x multiplier!)`);
                }
                
                return finalValue;
            }

            // Get detailed seed information for tooltips
            getSeedInfo(seedName) {
                const seedData = {
                    'Beanstalk': { 
                        growthTime: 25, type: 'Picker', rarity: 'common', 
                        sellValue: '12-16', cost: 120, 
                        description: 'A humble beginning to your farming empire.' 
                    },
                    'Snap Pea': { 
                        growthTime: 75, type: 'Picker', rarity: 'common', 
                        sellValue: '90', cost: 560, 
                        description: 'Quick to grow, satisfying to harvest.' 
                    },
                    'Jellybean Vine': { 
                        growthTime: 90, type: 'Picker', rarity: 'uncommon', 
                        sellValue: '170', cost: 1285, 
                        description: 'Sweet rewards for patient gardeners.' 
                    },
                    'Bamboo Bean': { 
                        growthTime: 120, type: 'Cutter', rarity: 'uncommon', 
                        sellValue: '300', cost: 5410, 
                        description: 'Strong and resilient, like bamboo itself.' 
                    },
                    'Coffee Creeper': { 
                        growthTime: 120, type: 'Picker', rarity: 'uncommon', 
                        sellValue: '540', cost: 9300, 
                        description: 'Energizing profits from caffeine-rich beans.' 
                    },
                    'Thunder Pod': { 
                        growthTime: 150, type: 'Cutter', rarity: 'rare', 
                        sellValue: '970', cost: 17000, 
                        description: 'Electrifying yields that strike like lightning.' 
                    },
                    'Frost Pea': { 
                        growthTime: 150, type: 'Picker', rarity: 'rare', 
                        sellValue: '2,700', cost: 31000, 
                        description: 'Cool profits from icy cold harvests.' 
                    },
                    'Choco Vine': { 
                        growthTime: 180, type: 'Picker', rarity: 'rare', 
                        sellValue: '3,500', cost: 35200, 
                        description: 'Sweet as chocolate, rich as gold.' 
                    },
                    'Iron Vine': { 
                        growthTime: 210, type: 'Cutter', rarity: 'legendary', 
                        sellValue: '15,300', cost: 90000, 
                        description: 'Forged in nature, stronger than steel.' 
                    },
                    'Honey Vine': { 
                        growthTime: 180, type: 'Picker', rarity: 'legendary', 
                        sellValue: '19,300', cost: 180000, 
                        description: 'Golden nectar flows from these vines.' 
                    },
                    'Sunbean': { 
                        growthTime: 240, type: 'Picker', rarity: 'legendary', 
                        sellValue: '25,500', cost: 193000, 
                        description: 'Harness the power of the sun itself.' 
                    },
                    'Moonbean': { 
                        growthTime: 240, type: 'Picker', rarity: 'mythical', 
                        sellValue: '43,000', cost: 253000, 
                        description: 'Mystical beans blessed by lunar energy.' 
                    },
                    'Cloud Creeper': { 
                        growthTime: 270, type: 'Picker', rarity: 'mythical', 
                        sellValue: '49,000', cost: 295000, 
                        description: 'Floating profits from sky-high yields.' 
                    },
                    'Royal Stalk': { 
                        growthTime: 300, type: 'Cutter', rarity: 'ultra-mythical', 
                        sellValue: '86,000', cost: 465000, 
                        description: 'Fit for kings, priced for emperors.' 
                    },
                    'Crystal Bean': { 
                        growthTime: 300, type: 'Picker', rarity: 'ultra-mythical', 
                        sellValue: '120,000', cost: 600000, 
                        description: 'Crystalline perfection in bean form.' 
                    },
                    'Neon Soy': { 
                        growthTime: 330, type: 'Cutter', rarity: 'ultra-mythical', 
                        sellValue: '160,000', cost: 570000, 
                        description: 'Glowing with otherworldly profits.' 
                    },
                    'Vinecorn': { 
                        growthTime: 240, type: 'Cutter', rarity: 'godly', 
                        sellValue: '210,000', cost: 1200000, 
                        description: 'Divine fusion of vine and grain.' 
                    },
                    'Fire Pod': { 
                        growthTime: 360, type: 'Cutter', rarity: 'godly', 
                        sellValue: '280,000', cost: 1800000, 
                        description: 'Burning bright with eternal flame.' 
                    },
                    'Shadow Bean': { 
                        growthTime: 300, type: 'Picker', rarity: 'godly', 
                        sellValue: '320,000', cost: 3182000, 
                        description: 'Dark power yields illuminating profits.' 
                    },
                    'Prism Stalk': { 
                        growthTime: 480, type: 'Picker', rarity: 'godly', 
                        sellValue: '340,000', cost: 5620000, 
                        description: 'Refracts light into pure prosperity.' 
                    }
                };
                
                return seedData[seedName] || {
                    growthTime: 60, type: 'Unknown', rarity: 'common', 
                    sellValue: '?', cost: 0, description: 'Mystery seed with unknown properties.'
                };
            }

            // Create and show seed tooltip
            createSeedTooltip() {
                if (this.seedTooltip) return;
                
                this.seedTooltip = document.createElement('div');
                this.seedTooltip.className = 'seed-tooltip';
                document.body.appendChild(this.seedTooltip);
            }

            // Show seed tooltip with information
            showSeedTooltip(seedItem, anchorX, anchorY) {
                if (!this.seedTooltip) this.createSeedTooltip();
                
                const seedInfo = this.getSeedInfo(seedItem.name);
                
                this.seedTooltip.innerHTML = `
                    <div class="tooltip-header">
                        <div class="tooltip-icon" style="background-image: url('${seedItem.image}')"></div>
                        <div class="tooltip-title">
                            <h3 class="tooltip-name">${seedItem.name}</h3>
                            <p class="tooltip-rarity ${seedInfo.rarity}">${seedInfo.rarity}</p>
                        </div>
                    </div>
                    <div class="tooltip-stats">
                        <div class="tooltip-stat">
                            <span class="stat-icon"></span>
                            <span>${seedInfo.growthTime}s</span>
                        </div>
                        <div class="tooltip-stat">
                            <span class="stat-icon"></span>
                            <span>$${seedInfo.sellValue}</span>
                        </div>
                        <div class="tooltip-stat">
                            <span class="stat-icon">${seedInfo.type === 'Picker' ? '' : ''}</span>
                            <span>${seedInfo.type}</span>
                        </div>
                        <div class="tooltip-stat">
                            <span class="stat-icon"></span>
                            <span>${seedItem.quantity}</span>
                        </div>
                    </div>
                    <div class="tooltip-description">${seedInfo.description}</div>
                `;
                
                // Show tooltip first to get accurate dimensions
                this.seedTooltip.style.visibility = 'hidden';
                this.seedTooltip.classList.add('visible');
                
                // Now get accurate dimensions for positioning
                const tooltipRect = this.seedTooltip.getBoundingClientRect();
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                
                // Start with tooltip to the right of the anchor point
                let tooltipX = anchorX;
                let tooltipY = anchorY - (tooltipRect.height / 2); // Center vertically on the item
                
                // If tooltip goes off the right edge, show it on the left side
                if (tooltipX + tooltipRect.width > screenWidth - 20) {
                    tooltipX = anchorX - tooltipRect.width - 20;
                }
                
                // If tooltip goes off the bottom, push it up
                if (tooltipY + tooltipRect.height > screenHeight - 20) {
                    tooltipY = screenHeight - tooltipRect.height - 20;
                }
                
                // If tooltip goes off the top, push it down
                if (tooltipY < 20) {
                    tooltipY = 20;
                }
                
                // Apply final position and make visible
                this.seedTooltip.style.left = tooltipX + 'px';
                this.seedTooltip.style.top = tooltipY + 'px';
                this.seedTooltip.style.visibility = 'visible';
            }

            // Hide seed tooltip
            hideSeedTooltip() {
                if (this.seedTooltip) {
                    this.seedTooltip.classList.remove('visible');
                }
            }

            // Spawn beans around a grown beanstalk
            spawnBeansAroundVine(potIndex, plantName, vineElement) {
                console.log(' DEBUG: spawnBeansAroundVine called for', plantName, 'in pot', potIndex);
                
                // Check if beans are already spawning for this vine
                const plantData = this.growingPlants.get(potIndex);
                if (plantData && plantData.isSpawningBeans) {
                    console.log(' DEBUG: Beans already spawning for pot', potIndex);
                    return;
                }
                
                const beanImage = this.getBeanImageForPlant(plantName);
                const potsContainer = document.getElementById('potsContainer');
                
                if (!potsContainer || !vineElement) {
                    console.error(' DEBUG: Missing potsContainer or vineElement');
                    return;
                }
                
                // Mark as spawning to prevent duplicate calls
                if (plantData) {
                    plantData.isSpawningBeans = true;
                    plantData.beanCount = 0;
                    plantData.beanSpawnIndex = 0; // Track spawn index for unique IDs
                    this.growingPlants.set(potIndex, plantData);
                }
                
                // Get vine position
                const vineRect = vineElement.getBoundingClientRect();
                const containerRect = potsContainer.getBoundingClientRect();
                
                // Calculate relative position
                const vineX = vineRect.left - containerRect.left + (vineRect.width / 2);
                const vineY = vineRect.top - containerRect.top + (vineRect.height / 2);
                
                console.log(' DEBUG: Starting continuous bean spawning around vine at', vineX, vineY);
                
                // Start initial burst of beans (8-12 beans immediately)
                const initialBeans = Math.floor(Math.random() * 5) + 8; // 8-12 initial beans
                const initialSpawnInterval = 600; // 600ms between initial beans
                
                for (let i = 0; i < initialBeans; i++) {
                    setTimeout(() => {
                        this.spawnSingleBeanRandomly(potIndex, beanImage, vineX, vineY, plantData.beanSpawnIndex++, plantName);
                    }, i * initialSpawnInterval + Math.random() * 200);
                }
                
                // Start continuous spawning system to maintain 20 beans max
                this.startContinuousSpawning(potIndex, beanImage, vineX, vineY, plantName);
                
                console.log(` DEBUG: Started initial batch of ${initialBeans} beans + continuous spawning system`);
            }

            // Start continuous spawning system to maintain max beans
            startContinuousSpawning(potIndex, beanImage, vineX, vineY, plantName) {
                const plantData = this.growingPlants.get(potIndex);
                if (!plantData) return;
                
                // Store spawning info for continuous use
                plantData.continuousSpawning = {
                    beanImage: beanImage,
                    vineX: vineX,
                    vineY: vineY,
                    plantName: plantName,
                    intervalId: null
                };
                
                // Start the continuous spawning interval (check every 2-4 seconds)
                const checkInterval = 2000 + Math.random() * 2000; // 2-4 seconds
                plantData.continuousSpawning.intervalId = setInterval(() => {
                    this.checkAndSpawnBeans(potIndex);
                }, checkInterval);
                
                this.growingPlants.set(potIndex, plantData);
                console.log(` DEBUG: Started continuous spawning for pot ${potIndex} (checking every ${Math.round(checkInterval/1000)}s)`);
            }

            // Check current bean count and spawn more if needed
            checkAndSpawnBeans(potIndex) {
                const plantData = this.growingPlants.get(potIndex);
                if (!plantData || !plantData.continuousSpawning) return;
                
                // Check if vine is still ready (not harvested)
                if (this.pots[potIndex]?.state !== 'ready') {
                    console.log(' DEBUG: Stopping continuous spawning - vine no longer ready');
                    this.stopContinuousSpawning(potIndex);
                    return;
                }
                
                // Count current beans around this vine
                const currentBeans = document.querySelectorAll(`[data-pot-index="${potIndex}"].vine-bean:not(.flying-to-money)`);
                const currentCount = currentBeans.length;
                const maxBeans = 20;
                
                if (currentCount < maxBeans) {
                    const beansToSpawn = Math.min(maxBeans - currentCount, 3); // Spawn 1-3 beans at a time
                    const spawning = plantData.continuousSpawning;
                    
                    console.log(` DEBUG: Pot ${potIndex} has ${currentCount}/${maxBeans} beans - spawning ${beansToSpawn} more`);
                    
                    // Spawn the needed beans with slight delays
                    for (let i = 0; i < beansToSpawn; i++) {
                        setTimeout(() => {
                            plantData.beanSpawnIndex = (plantData.beanSpawnIndex || 0) + 1;
                            this.spawnSingleBeanRandomly(
                                potIndex, 
                                spawning.beanImage, 
                                spawning.vineX, 
                                spawning.vineY, 
                                plantData.beanSpawnIndex, 
                                spawning.plantName
                            );
                        }, i * 300 + Math.random() * 200); // 300ms between spawns + random delay
                    }
                }
            }

            // Stop continuous spawning (when harvesting)
            stopContinuousSpawning(potIndex) {
                const plantData = this.growingPlants.get(potIndex);
                if (plantData?.continuousSpawning?.intervalId) {
                    clearInterval(plantData.continuousSpawning.intervalId);
                    plantData.continuousSpawning = null;
                    this.growingPlants.set(potIndex, plantData);
                    console.log(` DEBUG: Stopped continuous spawning for pot ${potIndex}`);
                }
            }

            // Spawn a single bean at a random position alongside the vine
            spawnSingleBeanRandomly(potIndex, beanImage, vineX, vineY, beanIndex, plantName) {
                const plantData = this.growingPlants.get(potIndex);
                if (!plantData) {
                    return; // Stop spawning if plant is gone
                }
                
                // Check current bean count via DOM (more reliable than tracking)
                const currentBeans = document.querySelectorAll(`[data-pot-index="${potIndex}"].vine-bean:not(.flying-to-money)`);
                if (currentBeans.length >= 20) {
                    console.log(' DEBUG: Max beans reached for pot', potIndex, '- skipping spawn');
                    return; // Already at max beans
                }
                
                const potsContainer = document.getElementById('potsContainer');
                if (!potsContainer) return;
                
                // Position beans closer to the middle of the vine, shifted slightly left
                const side = Math.random() < 0.5 ? -1 : 1; // -1 = left side, 1 = right side
                const sideDistance = 15 + Math.random() * 25; // Distance 15-40px from vine center (closer!)
                const randomX = (side * sideDistance) - 12; // Left or right of vine, with tiny bit more left shift (-12px)
                
                // Position along the vine height, shifted slightly up
                const vineHeight = 340; // Slightly reduced vine height (was 350)
                const randomY = Math.random() * vineHeight - (vineHeight * 0.4) - 10; // Shifted up by 25px (from +15 to -10)
                
                // Random rotation for orientation - this MUST be preserved!
                const randomRotation = Math.random() * 360; // 0-360 rotation
                const randomScale = 0.8 + Math.random() * 0.4; // Random size 0.8x-1.2x
                
                // Random animation delay
                const randomDelay = Math.random() * 1.5; // 0-1.5s delay
                
                // Generate bean rarity - 3% silver shiny, 3% golden
                const rarityRoll = Math.random();
                let beanRarity = 'none';
                if (rarityRoll < 0.03) {
                    beanRarity = 'shiny'; // Silver shiny - 3% chance, 200% more valuable
                } else if (rarityRoll < 0.06) {
                    beanRarity = 'golden'; // Golden - 3% chance, 500% more valuable  
                }
                
                // Create bean element
                const bean = document.createElement('div');
                bean.className = `vine-bean ${beanRarity !== 'none' ? 'rarity-' + beanRarity : ''}`;
                bean.style.backgroundImage = `url('${beanImage}')`;
                bean.style.left = (vineX + randomX) + 'px';
                bean.style.top = (vineY + randomY) + 'px';
                bean.style.animationDelay = randomDelay + 's';
                bean.dataset.potIndex = potIndex;
                bean.dataset.beanIndex = beanIndex;
                bean.dataset.plantName = plantName; // Store plant name for value calculation
                bean.dataset.rarity = beanRarity; // Store rarity for value calculation
                
                // Store the final transform values as CSS variables for the animation
                bean.style.setProperty('--final-scale', randomScale);
                bean.style.setProperty('--final-rotation', randomRotation + 'deg');
                
                // Add click event handler for amazing bean collection!
                bean.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.collectBean(bean, plantName);
                });
                
                // Bean starts invisible and small (CSS handles this via :not(.spawned))
                
                potsContainer.appendChild(bean);
                
                // Animate bean appearance after a brief delay
                setTimeout(() => {
                    // Add spawned class which triggers the pulse animation and makes it visible
                    bean.classList.add('spawned');
                    // Set the final transform that will be used by the CSS animation
                    bean.style.transform = `scale(${randomScale}) rotate(${randomRotation}deg)`;
                }, 50);
                
                console.log(` DEBUG: Spawned bean ${beanIndex} on ${side === -1 ? 'LEFT' : 'RIGHT'} side at (${Math.round(randomX)}, ${Math.round(randomY)}) with ${Math.round(randomRotation)} rotation (${currentBeans.length + 1}/20)`);
            }

            // Clean up beans when harvesting
            removeBeansFromVine(potIndex) {
                // Stop continuous spawning first
                this.stopContinuousSpawning(potIndex);
                
                const beans = document.querySelectorAll(`[data-pot-index="${potIndex}"].vine-bean`);
                beans.forEach(bean => {
                    bean.remove();
                });
                
                // Reset bean tracking state
                const plantData = this.growingPlants.get(potIndex);
                if (plantData) {
                    plantData.isSpawningBeans = false;
                    plantData.beanCount = 0;
                    this.growingPlants.set(potIndex, plantData);
                }
                
                console.log(' DEBUG: Removed', beans.length, 'beans from pot', potIndex, '+ stopped continuous spawning');
            }

            // AMAZING bean collection with flying animation!
            collectBean(beanElement, plantName) {
                if (beanElement.classList.contains('flying-to-money')) {
                    return; // Already being collected
                }
                
                console.log(' DEBUG: Collecting bean from', plantName);
                
                // Get bean value with rarity multiplier
                const beanRarity = beanElement.dataset.rarity || 'none';
                const beanValue = this.getBeanValueForPlant(plantName, beanRarity);
                
                // IMMEDIATE SATISFYING CLICK EFFECTS! 
                this.playClickEffects(beanElement);
                
                // Play bean collection sound - alternate between two sounds for variety
                const beanSounds = ['collectbean', 'collectbean2'];
                const randomSound = beanSounds[Math.floor(Math.random() * beanSounds.length)];
                this.playSound(randomSound);
                
                // Mark bean as flying to prevent multiple clicks
                beanElement.classList.add('flying-to-money');
                
                // Start the flying animation after click effect (300ms delay for satisfaction)
                setTimeout(() => {
                    this.animateBeanToMoney(beanElement, beanValue);
                }, 300);
            }

            // Play immediate satisfying click effects
            playClickEffects(beanElement) {
                // Add satisfying pop animation to the bean
                beanElement.classList.add('clicked');
                
                // Create burst effect around the bean
                const beanRect = beanElement.getBoundingClientRect();
                const potsContainer = document.getElementById('potsContainer');
                
                const burst = document.createElement('div');
                burst.className = 'click-burst';
                burst.style.position = 'fixed';
                burst.style.left = (beanRect.left + beanRect.width/2 - 60) + 'px'; // Center the 120px burst
                burst.style.top = (beanRect.top + beanRect.height/2 - 60) + 'px';
                burst.style.zIndex = '99';
                
                document.body.appendChild(burst);
                
                // Remove burst after animation
                setTimeout(() => {
                    burst.remove();
                }, 400);
                
                // Add screen shake effect for extra satisfaction
                this.addScreenShake();
                
                console.log(' DEBUG: Click effects triggered!');
            }

            // Add subtle screen shake for satisfying feedback
            addScreenShake() {
                const gameContainer = document.getElementById('gameContainer');
                if (gameContainer) {
                    gameContainer.style.animation = 'screenShake 0.2s ease-in-out';
                    
                    setTimeout(() => {
                        gameContainer.style.animation = '';
                    }, 200);
                }
            }

            // Amazing flying animation from bean to money display
            animateBeanToMoney(beanElement, beanValue) {
                // Get current positions
                const beanRect = beanElement.getBoundingClientRect();
                const moneyElement = document.getElementById('moneyAmount');
                const moneyRect = moneyElement.getBoundingClientRect();
                
                // Calculate the flight path
                const startX = beanRect.left + beanRect.width / 2;
                const startY = beanRect.top + beanRect.height / 2;
                const endX = moneyRect.left + moneyRect.width / 2;
                const endY = moneyRect.top + moneyRect.height / 2;
                
                // Create a clone for the animation
                const flyingBean = beanElement.cloneNode(true);
                flyingBean.style.position = 'fixed';
                flyingBean.style.left = startX + 'px';
                flyingBean.style.top = startY + 'px';
                flyingBean.style.zIndex = '100';
                flyingBean.style.pointerEvents = 'none';
                flyingBean.classList.add('flying-to-money');
                flyingBean.style.width = '40px';
                flyingBean.style.height = '40px';
                
                document.body.appendChild(flyingBean);
                
                // REMOVE THE ORIGINAL BEAN IMMEDIATELY when flight starts!
                beanElement.remove();
                
                console.log(` DEBUG: Flying bean from (${Math.round(startX)}, ${Math.round(startY)}) to (${Math.round(endX)}, ${Math.round(endY)})`);
                
                // Calculate flight duration based on distance (longer for dramatic effect)
                const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                const duration = Math.min(Math.max(distance / 300, 1.2), 2.5); // 1.2-2.5 seconds (longer)
                
                // Apply the flying animation with calculated duration
                flyingBean.style.animation = `beanFlyToMoney ${duration}s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards`;
                
                // Create beautiful curved path animation
                this.animateAlongCurvedPath(flyingBean, startX, startY, endX, endY, duration);
                
                // Add money and effects when bean reaches destination
                setTimeout(() => {
                    // Add the money!
                    this.addMoney(beanValue);
                    
                    // Show money burst effect
                    this.showMoneyBurst(endX, endY, beanValue);
                    
                    // Remove the flying bean
                    flyingBean.remove();
                    
                    console.log(` DEBUG: Bean collected! Added $${beanValue.toLocaleString()}`);
                    
                    // Trigger immediate check for spawning replacement bean (after a short delay)
                    const potIndex = parseInt(flyingBean.dataset.potIndex); // Use flyingBean since original is gone
                    if (!isNaN(potIndex)) {
                        setTimeout(() => {
                            this.checkAndSpawnBeans(potIndex);
                        }, 500 + Math.random() * 1000); // 0.5-1.5 second delay
                    }
                    
                }, duration * 1000);
            }

            // Animate bean along a beautiful curved path across the screen
            animateAlongCurvedPath(beanElement, startX, startY, endX, endY, duration) {
                // Calculate control points for a dramatic arc
                const midX = (startX + endX) / 2;
                const midY = Math.min(startY, endY) - 150 - Math.random() * 50; // Higher arc (150-200px up)
                
                // Use requestAnimationFrame for smooth animation
                const startTime = performance.now();
                
                const animateStep = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    let progress = Math.min(elapsed / (duration * 1000), 1);
                    
                    // Apply easing for more satisfying movement (ease-in-out-back)
                    progress = progress < 0.5 
                        ? 2 * progress * progress 
                        : -1 + (4 - 2 * progress) * progress;
                    
                    // Quadratic Bzier curve calculation
                    const t = progress;
                    const x = Math.pow(1 - t, 2) * startX + 2 * (1 - t) * t * midX + Math.pow(t, 2) * endX;
                    const y = Math.pow(1 - t, 2) * startY + 2 * (1 - t) * t * midY + Math.pow(t, 2) * endY;
                    
                    // Add slight wobble for more organic movement
                    const wobbleX = 5 * Math.sin(progress * Math.PI * 8) * (1 - progress);
                    const wobbleY = 3 * Math.cos(progress * Math.PI * 12) * (1 - progress);
                    
                    // Update position with wobble
                    beanElement.style.left = (x + wobbleX) + 'px';
                    beanElement.style.top = (y + wobbleY) + 'px';
                    
                    // Scale the bean slightly during flight for depth effect
                    const scale = 1.2 + (0.3 * Math.sin(progress * Math.PI));
                    beanElement.style.transform = `scale(${scale}) rotate(${progress * 720}deg)`;
                    
                    // Add subtle opacity pulsing
                    beanElement.style.opacity = 0.95 + (0.05 * Math.sin(progress * Math.PI * 4));
                    
                    if (progress < 1) {
                        requestAnimationFrame(animateStep);
                    } else {
                        // Ensure final position is exact
                        beanElement.style.left = endX + 'px';
                        beanElement.style.top = endY + 'px';
                    }
                };
                
                requestAnimationFrame(animateStep);
            }

            // Add money to player's total
            addMoney(amount) {
                this.currentMoney += amount;
                this.updateMoneyDisplay();
                
                // Play coin sound effect
                this.playSound('coin');
            }

            // ===== AUDIO SYSTEM =====
            
            initializeAudioSystem() {
                console.log(' Initializing audio system...');
                
                // Preload background music
                this.backgroundMusic = new Audio('Sound/backgroundmusic1.mp3');
                this.backgroundMusic.loop = true;
                this.backgroundMusic.volume = 0.4; // Background music quieter
                
                // Preload sound effects
                this.sounds = {
                    coin: new Audio('Sound/coin.mp3'),
                    collectbean: new Audio('Sound/collectbean.mp3'),
                    collectbean2: new Audio('Sound/collectbean2.mp3')
                };
                
                // Set volume for all sounds
                Object.values(this.sounds).forEach(sound => {
                    sound.volume = this.volume;
                });
                
                console.log(' Audio system initialized!');
            }

            startBackgroundMusic() {
                if (this.backgroundMusic) {
                    // Try to play immediately, but handle autoplay restrictions
                    this.backgroundMusic.play().catch(error => {
                        console.log(' Background music autoplay blocked - will start on first user interaction');
                        // Add a one-time click listener to start music on first interaction
                        const startMusicOnClick = () => {
                            this.backgroundMusic.play().then(() => {
                                console.log(' Background music started after user interaction');
                            });
                            document.removeEventListener('click', startMusicOnClick);
                        };
                        document.addEventListener('click', startMusicOnClick);
                    });
                }
            }

            playSound(soundName) {
                const sound = this.sounds[soundName];
                if (sound) {
                    // Create a clone for overlapping sounds
                    const soundClone = sound.cloneNode();
                    soundClone.volume = this.volume;
                    soundClone.play().catch(error => {
                        console.log(` Failed to play sound: ${soundName}`, error);
                    });
                }
            }

            // Show satisfying money burst effect
            showMoneyBurst(x, y, amount) {
                const burst = document.createElement('div');
                burst.className = 'money-burst';
                burst.textContent = `+$${amount.toLocaleString()}`;
                burst.style.left = (x - 50) + 'px'; // Center the text
                burst.style.top = (y - 10) + 'px';
                
                document.body.appendChild(burst);
                
                // Remove burst after animation
                setTimeout(() => {
                    burst.remove();
                }, 1500);
            }

            // Initialize plant data
            initializePlantData() {
                return [
                    // Common Plants
                    { name: 'Beanstalk', type: 'Picker', growthTime: 25, buyPrice: 50, sellPrice: 80, rarity: 'Common', availability: 8 },
                    { name: 'Snap Pea', type: 'Picker', growthTime: 75, buyPrice: 90, sellPrice: 145, rarity: 'Common', availability: 7 },
                    { name: 'Jellybean Vine', type: 'Picker', growthTime: 90, buyPrice: 170, sellPrice: 285, rarity: 'Common', availability: 6 },
                    { name: 'Bamboo-Bean', type: 'Cutter', growthTime: 120, buyPrice: 300, sellPrice: 510, rarity: 'Common', availability: 6 },
                    { name: 'Coffee Creeper', type: 'Picker', growthTime: 120, buyPrice: 540, sellPrice: 900, rarity: 'Common', availability: 5 },
                    { name: 'Thunder Pod', type: 'Cutter', growthTime: 150, buyPrice: 970, sellPrice: 1700, rarity: 'Common', availability: 4 },
                    { name: 'Frost Pea', type: 'Picker', growthTime: 150, buyPrice: 1700, sellPrice: 3000, rarity: 'Common', availability: 3 },
                    { name: 'Choco Vine', type: 'Picker', growthTime: 180, buyPrice: 3000, sellPrice: 5200, rarity: 'Common', availability: 2 },
                    
                    // Uncommon Plants
                    { name: 'Ironvine', type: 'Cutter', growthTime: 210, buyPrice: 5300, sellPrice: 9000, rarity: 'Uncommon', availability: 7 },
                    { name: 'Honeyvine', type: 'Picker', growthTime: 180, buyPrice: 9300, sellPrice: 18000, rarity: 'Uncommon', availability: 6 },
                    { name: 'Sunbean', type: 'Picker', growthTime: 240, buyPrice: 16000, sellPrice: 30000, rarity: 'Uncommon', availability: 5 },
                    { name: 'Moonbean', type: 'Picker', growthTime: 240, buyPrice: 28000, sellPrice: 53000, rarity: 'Uncommon', availability: 4 },
                    { name: 'Cloud Creeper', type: 'Picker', growthTime: 270, buyPrice: 49000, sellPrice: 95000, rarity: 'Uncommon', availability: 3 },
                    { name: 'Royal Stalk', type: 'Cutter', growthTime: 300, buyPrice: 86000, sellPrice: 165000, rarity: 'Uncommon', availability: 2 },
                    { name: 'Crystal Bean', type: 'Picker', growthTime: 300, buyPrice: 150000, sellPrice: 300000, rarity: 'Uncommon', availability: 1 },
                    
                    // Rare Plants
                    { name: 'Neon Soy', type: 'Cutter', growthTime: 330, buyPrice: 260000, sellPrice: 570000, rarity: 'Rare', availability: 5 },
                    { name: 'Vinecorn', type: 'Cutter', growthTime: 240, buyPrice: 450000, sellPrice: 1000000, rarity: 'Rare', availability: 4 },
                    { name: 'Fire Pod', type: 'Cutter', growthTime: 360, buyPrice: 780000, sellPrice: 1800000, rarity: 'Rare', availability: 3 },
                    { name: 'Shadow Bean', type: 'Picker', growthTime: 300, buyPrice: 1350000, sellPrice: 3182000, rarity: 'Rare', availability: 2 },
                    { name: 'Prism Stalk', type: 'Picker', growthTime: 480, buyPrice: 2340000, sellPrice: 5620000, rarity: 'Rare', availability: 1 }
                ];
            }

            // Initialize modifier data
            initializeModifierData() {
                return {
                    size: [
                        { name: 'Normal', multiplier: 1.0, probability: 65, description: 'Standard size' },
                        { name: 'Large', multiplier: 1.8, probability: 30, description: '1.8 size boost' },
                        { name: 'Massive', multiplier: 3.2, probability: 5, description: '3.2 size boost' }
                    ],
                    finish: [
                        { name: 'None', multiplier: 1.0, probability: 95, description: 'No special finish' },
                        { name: 'Shiny', multiplier: 1.5, probability: 3, description: '1.5 value boost' },
                        { name: 'Golden', multiplier: 2.0, probability: 2, description: '2.0 value boost' }
                    ]
                };
            }
        }

        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', () => {
            window.gameManager = new GameManager();
        });

        // Handle escape key to exit fullscreen
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && window.gameManager && window.gameManager.isFullscreen) {
                document.exitFullscreen();
                window.gameManager.isFullscreen = false;
            }
        });
    </script>
</body>
</html>
